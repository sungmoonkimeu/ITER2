

<!DOCTYPE html>
<html class="writer-html4" lang="English" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>py_pol.stokes &mdash; Python polarization 1.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Python polarization
          

          
          </a>

          
            
            
              <div class="version">
                1.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">1. Python polarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">3. Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">4. py_pol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">5. Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">6. Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">7. History</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python polarization</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>py_pol.stokes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for py_pol.stokes</h1><div class="highlight"><pre>
<span></span><span class="c1"># !/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># ------------------------------------</span>
<span class="c1"># Authors:    Luis Miguel Sanchez Brea and Jesus del Hoyo</span>
<span class="c1"># Date:       2019/01/09 (version 1.0)</span>
<span class="c1"># License:    GPL</span>
<span class="c1"># -------------------------------------</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">We present a number of functions for polarization using Stokes framework:</span>

<span class="sd">**Class fields**</span>
<span class="sd">    * **M**: 2xN array containing all the Stokes vectors.</span>
<span class="sd">    * **global_phase**: Global phase of the light state.</span>
<span class="sd">    * **name**: Name of the object for print purposes.</span>
<span class="sd">    * **shape**: Shape desired for the outputs.</span>
<span class="sd">    * **size**: Number of stores Stokes vectors.</span>
<span class="sd">    * **_type**: Type of the object (&#39;Jones_vector&#39;). This is used for determining the object class as using isinstance may throw unexpected results in .ipynb files.</span>
<span class="sd">    * **parameters**: Object of class *Parameters_Jones_vector*.</span>
<span class="sd">    * **checks**: Object of class *Checks_Jones_vector*.</span>

<span class="sd">**Generation methods**</span>
<span class="sd">    * **from_components**: Creates Stokes vectors directly from the 4 elements $S_0$, $S_1$, $S_2$, $S_3$.</span>
<span class="sd">    * **from_matrix**: Creates Stokes vectors from an external 4 x shape numpy array.</span>
<span class="sd">    * **from_list**: Creates a Jones_vector object directly from a list of 4 or 4x1 numpy arrays.</span>
<span class="sd">    * **from_Jones**: Creates Stokes vectors from a Jones_vector object.</span>
<span class="sd">    * **linear_light**: Creates Stokes vectors for pure linear polarizer light.</span>
<span class="sd">    * **circular_light**: Creates Stokes vectors for pure circular polarizer light.</span>
<span class="sd">    * **elliptical_light** Creates Stokes vectors for polarizer elliptical light.</span>
<span class="sd">    * **general_charac_angles** Creates Stokes vectors given by their characteristic angles.</span>
<span class="sd">    * **general_azimuth_ellipticity** Creates Stokes vectors given by their azimuth and ellipticity.</span>

<span class="sd">**Manipulation methods**</span>
<span class="sd">    * **clear**:  Removes data and name form Stokes vectors.</span>
<span class="sd">    * **copy**:  Creates a copy of the Jones_vector object.</span>
<span class="sd">    * **stretch**:  Stretches a Stokes vectors of size 1.</span>
<span class="sd">    * **shape_like**:  Takes the shape of another object to use as its own.</span>
<span class="sd">    * **simplify**:  Simplifies the Stokes vectors in several ways.</span>
<span class="sd">    * **rotate**: Rotates the Stokes vectors.</span>
<span class="sd">    * **sum**: Calculates the summatory of the Stokes vectors in the object.</span>
<span class="sd">    * **flip**: Flips the object along some dimensions.</span>
<span class="sd">    * **reciprocal**: Calculates the Stokes vectors that propagates backwards.</span>
<span class="sd">    * **orthogonal**: Calculates the orthogonal Stokes vectors.</span>
<span class="sd">    * **normalize**: Normalize the electric field to be normalized in electric field amplitude or intensity.</span>
<span class="sd">    * **rotate_to_azimuth**: Rotates the Stokes vectors to have a certain azimuth.</span>
<span class="sd">    * **remove_global_phase**: Calculates the global phase of the electric field (respect to the X component) and removes it.</span>
<span class="sd">    * **add_global_phase**: Adds a global phase to the Stokes vectors.</span>
<span class="sd">    * **set_global_phase**: Sets the global phase of the Stokes vectors.</span>
<span class="sd">    * **set_depolarization**: Sets the degree of depolarization.</span>
<span class="sd">    * **add_depolarization**: Increases the degree of depolarization.</span>
<span class="sd">    * **draw_ellipse**:  Draws the polarization ellipse of the Stokes vectors.</span>


<span class="sd">**Parameters subclass methods**</span>
<span class="sd">    * **matrix**:  Gets a numpy array with the Stokes vectors.</span>
<span class="sd">    * **components**: Calculates the electric field components of the Stokes vectors.</span>
<span class="sd">    * **amplitudes**: Calculates the electric field amplitudes of the Stokes vectors.</span>
<span class="sd">    * **intensity**: Calculates the intensity of the Stokes vectors.</span>
<span class="sd">    * **irradiance**: Calculates the irradiance of the Stokes vectors.</span>
<span class="sd">    * **alpha**: Calculates the ratio between electric field amplitudes ($E_x$/$E_y$).</span>
<span class="sd">    * **delay / delta**: Calculates the delay (phase shift) between Ex and Ey components of the electric field.</span>
<span class="sd">    * **charac_angles**: Calculates both alpha and delay, the characteristic angles of the Stokes vectors.</span>
<span class="sd">    * **azimuth**: Calculates azimuth, that is, the orientation angle of the major axis.</span>
<span class="sd">    * **ellipticity_angle**: Calculates the ellipticity angle.</span>
<span class="sd">    * **azimuth_ellipticity**: Calculates both azimuth and ellipticity angles.</span>
<span class="sd">    * **ellipse_axes**: Calculates the length of major and minor axis (a,b).</span>
<span class="sd">    * **ellipticity_param**: Calculates the ellipticity parameter, b/a.</span>
<span class="sd">    * **eccentricity**: Calculates the eccentricity, the complementary of the ellipticity parameter.</span>
<span class="sd">    * **global_phase**: Calculates the global phase of the Stokes vectors (respect to the X component of the electric field).</span>
<span class="sd">    * **degree_polarization**: Calculates the degree of polarization of the Stokes vectors.</span>
<span class="sd">    * **degree_depolarization**: Calculates the degree of depolarization of the Stokes vectors.</span>
<span class="sd">    * **degree_linear_polarization**: Calculates the degree of linear polarization of the Stokes vectors.</span>
<span class="sd">    * **degree_circular_polarization**: Calculates the degree of circular polarization of the Stokes vectors.</span>
<span class="sd">    * **norm**: Calculates the norm of the Stokes vectors.</span>
<span class="sd">    * **polarized_unpolarized**: Divides the Stokes vector in Sp+Su, where Sp is fully-polarized and Su fully-unpolarized.</span>

<span class="sd">    * **get_all**: Returns a dictionary with all the parameters of Stokes vectors.</span>


<span class="sd">**Checks subclass methods**</span>
<span class="sd">    * **is_physical**: Checks if the Stokes vectors are physically realizable.</span>
<span class="sd">    * **is_linear**: Checks if the Stokes vectors are lienarly polarized.</span>
<span class="sd">    * **is_circular**: Checks if the Stokes vectors are circularly polarized.</span>
<span class="sd">    * **is_right_handed**: Checks if the Stokes vectors rotation direction are right handed.</span>
<span class="sd">    * **is_left_handed**: Checks if the Stokes vectors rotation direction are left handed.</span>
<span class="sd">    * **is_polarized**: Checks if the Stokes vectors are at least partially polarized.</span>
<span class="sd">    * **is_totally_polarized**: Checks if the Stokes vectors are totally polarized.</span>
<span class="sd">    * **is_depolarized**: Checks if the Stokes vectors are at least partially depolarized.</span>
<span class="sd">    * **is_totally_depolarized**: Checks if the Stokes vectors are totally depolarized.</span>

<span class="sd">    * **get_all**: Returns a dictionary with all the checks of Stokes vectors.</span>


<span class="sd">**Analysis subclass methods**</span>
<span class="sd">    * **filter_physical_conditions**: Forces the Stokes vectors to be physically realizable.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">arctan2</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">num_decimals</span><span class="p">,</span> <span class="n">number_types</span>
<span class="kn">from</span> <span class="nn">.drawings</span> <span class="k">import</span> <span class="n">draw_ellipse</span><span class="p">,</span> <span class="n">draw_poincare</span>
<span class="kn">from</span> <span class="nn">.jones_vector</span> <span class="k">import</span> <span class="n">Jones_vector</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">azimuth_elipt_2_charac_angles</span><span class="p">,</span> <span class="n">put_in_limits</span><span class="p">,</span> <span class="n">repair_name</span><span class="p">,</span>
                    <span class="n">rotation_matrix_Mueller</span><span class="p">,</span> <span class="n">prepare_variables</span><span class="p">,</span> <span class="n">reshape</span><span class="p">,</span>
                    <span class="n">PrintParam</span><span class="p">,</span> <span class="n">take_shape</span><span class="p">,</span> <span class="n">select_shape</span><span class="p">,</span> <span class="n">PrintMatrices</span><span class="p">,</span>
                    <span class="n">combine_indices</span><span class="p">,</span> <span class="n">merge_indices</span><span class="p">,</span> <span class="n">multitake</span><span class="p">,</span>
                    <span class="n">fit_distribution</span><span class="p">)</span>

<span class="n">stokes_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">tol_default</span> <span class="o">=</span> <span class="n">eps</span>
<span class="n">N_print_list</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">print_list_spaces</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">change_names</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">unknown_phase</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">default_phase</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># TODO: función para luz eliptica (a, b, angulo, polarización)? No sabía hacer</span>

<span class="c1"># # define Python user-defined exceptions</span>
<span class="c1"># class Error(Exception):</span>
<span class="c1">#     &quot;&quot;&quot;Base class for other exceptions&quot;&quot;&quot;</span>
<span class="c1">#     pass</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># class CustomError(Error):</span>
<span class="c1">#     &quot;&quot;&quot;Raised when a custom error is produced&quot;&quot;&quot;</span>
<span class="c1">#     pass</span>

<span class="c1">################################################################################</span>
<span class="c1"># Functions</span>
<span class="c1">################################################################################</span>


<div class="viewcode-block" id="create_Stokes"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.create_Stokes">[docs]</a><span class="k">def</span> <span class="nf">create_Stokes</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_object</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that creates several Stokes objects att he same time from a list of names or a number.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        names (str, list or tuple): name of vector for string representation. If list or tuple, it also represents the number of objects to be created.</span>
<span class="sd">        N (int): Number of elements to be created. This parameter is overrided if name is a list or tuple. Defeult: 1.</span>
<span class="sd">        out_object (bool): if True and the result is a list of length 1, return a Stokes object instead. Default: True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        S (Stokes or list): List of Stokes vectors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Stokes</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Stokes</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">out_object</span><span class="p">:</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">S</span></div>


<div class="viewcode-block" id="set_printoptions"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.set_printoptions">[docs]</a><span class="k">def</span> <span class="nf">set_printoptions</span><span class="p">(</span><span class="n">N_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">list_spaces</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that modifies the global print options parameters.</span>

<span class="sd">    TODO: Single global function for all modules</span>

<span class="sd">    Parameters:</span>
<span class="sd">        N_print_list (int): Number of matrices that will be printed as a list if the shape of the object is 1D.</span>
<span class="sd">        print_list_spaces (int): Number ofspaces between matrices if they are printed as a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">N_print_list</span><span class="p">,</span> <span class="n">print_list_spaces</span>
    <span class="k">if</span> <span class="n">list_spaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">print_list_spaces</span> <span class="o">=</span> <span class="n">list_spaces</span>
    <span class="k">if</span> <span class="n">N_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">N_print_list</span> <span class="o">=</span> <span class="n">N_list</span></div>


<span class="c1">################################################################################</span>
<span class="c1"># Main class</span>
<span class="c1">################################################################################</span>


<div class="viewcode-block" id="Stokes"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes">[docs]</a><span class="k">class</span> <span class="nc">Stokes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for Stokes vectors</span>

<span class="sd">    Parameters:</span>
<span class="sd">        M (float or numpy.ndarray): 4xN array containing all the Stokes vectors.</span>
<span class="sd">        name (string): Name of the object for print purposes.</span>
<span class="sd">        shape (tuple or list): Shape desired for the outputs.</span>
<span class="sd">        size (int): Number of stored Stokes vectors.</span>
<span class="sd">        ndim (int): Number of dimensions for representation purposes.</span>
<span class="sd">        global_phase (float or numpy.ndarray): Global phase of the Stokes vector. If it is a numpy.ndarray, it must have the same number of elements than self.size. It is used for addition and substraction.</span>
<span class="sd">        _type (string): Type of the object (&#39;Stokes&#39;). This is used for determining the object class as using isinstance may throw unexpected results in .ipynb files.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        self.parameters (class): Class containing the measurable parameters of Stokes vectors.</span>
<span class="sd">        self.checks (class): Class containing the methods that check something about the Stokes vectors.</span>
<span class="sd">        self.analysis (class): Class containing the methods to analyze the Stokes vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__array_priority__</span> <span class="o">=</span> <span class="mi">15000</span>

    <span class="c1"># def _actualize_(f):</span>
    <span class="c1">#     @wraps(f)</span>
    <span class="c1">#     def wrapped(inst, *args, **kwargs):</span>
    <span class="c1">#         result = f(inst, *args, **kwargs)</span>
    <span class="c1">#         inst.update()</span>
    <span class="c1">#         return result</span>
    <span class="c1">#</span>
    <span class="c1">#     return wrapped</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers during the Stokes inicialization..</span>

<span class="sd">        Parameters:</span>
<span class="sd">            name (string): Name of the object for representation purposes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s1">&#39;Stokes&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">stokes_0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">Parameters_Stokes_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span> <span class="o">=</span> <span class="n">Analysis_Stokes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checks</span> <span class="o">=</span> <span class="n">Check_Stokes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds two fields represented by their Stokes or Stokes vectors.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            other (Stokes or Jones_vector): 2nd field to add.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M3</span> <span class="o">=</span> <span class="n">Stokes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span><span class="p">:</span>
            <span class="c1"># Easy case, incoherent sum</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">global_phase</span><span class="p">):</span>
                <span class="n">M3</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">global_phase</span><span class="p">):</span>
                <span class="n">M3</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">M</span><span class="p">,</span>
                               <span class="n">global_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">)</span>
            <span class="c1"># More complicated case, coherent sum</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Divide Stokes vectors in polarized and unpolarized counterparts</span>
                <span class="n">s_pol</span><span class="p">,</span> <span class="n">s_unpol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">()</span>
                <span class="n">o_pol</span><span class="p">,</span> <span class="n">o_unpol</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">()</span>
                <span class="c1"># Create the Stokes vectors corresponding to the polarized parts and add them</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">Jones_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">s</span><span class="o">.</span><span class="n">from_Stokes</span><span class="p">(</span><span class="n">s_pol</span><span class="p">)</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">Jones_vector</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">o</span><span class="o">.</span><span class="n">from_Stokes</span><span class="p">(</span><span class="n">o_pol</span><span class="p">)</span>
                <span class="n">m3</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">o</span>
                <span class="c1"># Reconvert to Stokes and add the unpolarized parts</span>
                <span class="n">M3</span><span class="o">.</span><span class="n">from_Jones</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
                <span class="n">M3</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">M3</span><span class="o">.</span><span class="n">M</span> <span class="o">+</span> <span class="n">s_unpol</span><span class="o">.</span><span class="n">M</span> <span class="o">+</span> <span class="n">o_unpol</span><span class="o">.</span><span class="n">M</span>
        <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Jones_vector&#39;</span><span class="p">:</span>
            <span class="c1"># If self has unknown global phase, make the sum incoherent</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">Stokes</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">S</span><span class="o">.</span><span class="n">from_Jones</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="n">M3</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">+</span> <span class="n">S</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># Coherent sum</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Divide Stokes vectors in polarized and unpolarized counterparts</span>
                <span class="n">s_pol</span><span class="p">,</span> <span class="n">s_unpol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">()</span>
                <span class="c1"># Create the Stokes vectors corresponding to the polarized parts and add them</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">Jones_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">s</span><span class="o">.</span><span class="n">from_Stokes</span><span class="p">(</span><span class="n">s_pol</span><span class="p">)</span>
                <span class="n">m3</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">other</span>
                <span class="c1"># Reconvert to Stokes and add the unpolarized parts</span>
                <span class="n">M3</span><span class="o">.</span><span class="n">from_Jones</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
                <span class="n">M3</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">M3</span><span class="o">.</span><span class="n">M</span> <span class="o">+</span> <span class="n">s_unpol</span><span class="o">.</span><span class="n">M</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;other is </span><span class="si">{}</span><span class="s1"> instead of Stokes or Jones_vector.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
        <span class="c1"># Fix name and update common variables</span>
        <span class="n">M3</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">take_shape</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">M3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; + &quot;</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
        <span class="n">M3</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">M3</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Substracts two fields represented by their Stokes or Stokes vectors.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            other (Stokes or Jones_vector): 2nd field to substract.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M3</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">M3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">M3</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiplies a Stokes vector by a number. If the number is complex or real negative, the absolute value is used and the global phase is updated acordingly.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            other (float, complex or numpy.ndarray): number to multiply.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># If we have a number, name can be updated</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">number_types</span><span class="p">)</span> <span class="ow">and</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">M3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; * &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># Calculate components</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Save the Number of elements, and then flatten</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">size</span>
            <span class="n">other2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">other2</span> <span class="o">=</span> <span class="n">other</span>
        <span class="c1"># Check that the multiplication can be performed</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Calculate the absolute value and complex phase of the number</span>
            <span class="n">mod</span><span class="p">,</span> <span class="n">phase</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">other2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">other2</span><span class="p">))</span>
            <span class="c1"># Create the object</span>
            <span class="n">M3</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span> <span class="o">*</span> <span class="n">mod</span><span class="p">,</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">mod</span><span class="p">,</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">mod</span><span class="p">,</span> <span class="n">S3</span> <span class="o">*</span> <span class="n">mod</span><span class="p">),</span>
                               <span class="n">global_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">)</span>
            <span class="n">M3</span><span class="o">.</span><span class="n">add_global_phase</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">M3</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">take_shape</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;The number of elements in other (</span><span class="si">{}</span><span class="s1">) and self </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">) is not the same&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">M3</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">M3</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiplies a Stokes vector by a number. If the number is complex or real negative, the absolute value is used and the global phase is updated acordingly.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            other (float, complex or numpy.ndarray): number to multiply.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M3</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">number_types</span><span class="p">)</span> <span class="ow">and</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">M3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; * &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">M3</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divides a Stokes vector by a number. If the number is complex or real negative, the absolute value is used and the global phase is updated acordingly.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            other (float or numpy.ndarray): Divisor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M3</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="n">other</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">number_types</span><span class="p">)</span> <span class="ow">and</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">M3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">M3</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Represents the Stokes vector with print().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract the components</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">()</span>
        <span class="c1"># If the object is empty, say it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is empty</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># If the object is 0D or 1D, print it like a list or inline</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="n">N_print_list</span><span class="p">:</span>
                <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">l0_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">l1_name</span> <span class="o">=</span> <span class="n">PrintMatrices</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">print_list_spaces</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">l0_name</span> <span class="o">+</span> <span class="n">l1_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l0_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> S0 = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">S0</span><span class="p">)</span>
                <span class="n">l1_name</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; S1 = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
                <span class="n">l2_name</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; S2 = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
                <span class="n">l3_name</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; S3 = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S3</span><span class="p">)</span>
        <span class="c1"># Print higher dimensionality as pure arrays</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l0_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> S0 = </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">S0</span><span class="p">)</span>
            <span class="n">l1_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> S1 = </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">S1</span><span class="p">)</span>
            <span class="n">l2_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> S2 = </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">S2</span><span class="p">)</span>
            <span class="n">l3_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> S3 = </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">S3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l0_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">l1_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">l2_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">l3_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives the size of the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements object extraction from indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">Stokes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_picked&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">Stokes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># If the indices are 1D, act upon the matrix directly</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">))</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
                                       <span class="ow">and</span> <span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cond</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[:,</span> <span class="n">index</span><span class="p">])</span>
            <span class="c1"># Add global phase</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">S</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">S</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># If not, act upon the components</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">S0</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">S1</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">S2</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">S3</span><span class="p">[</span><span class="n">index</span><span class="p">]])</span>
            <span class="n">S</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># Add global phase</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">S</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">S</span><span class="o">.</span><span class="n">set_global_phase</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">S</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements object inclusion from indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that data is a correct pypol object</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Jones_vector&#39;</span><span class="p">:</span>
            <span class="n">data2</span> <span class="o">=</span> <span class="n">Stokes</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">data2</span><span class="o">.</span><span class="n">from_Jones</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span><span class="p">:</span>
            <span class="n">data2</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;data is type </span><span class="si">{}</span><span class="s1"> instead of Jones_vector or Stokes.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">_type</span><span class="p">))</span>
        <span class="c1"># Expand phase if required</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">data2</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data2</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># If the indices are 1D, act upon the matrix directly</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data2</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># Add global phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">global_phase</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">step</span>
                <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">index</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">index</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">data3</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data3</span> <span class="o">=</span> <span class="n">data2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data3</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
            <span class="c1"># Add global phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data3</span><span class="o">.</span><span class="n">global_phase</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">M</span>
            <span class="c1"># Add global phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">global_phase</span>
        <span class="c1"># If not, act upon the components</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Extract phase and components</span>
            <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">S0_new</span><span class="p">,</span> <span class="n">S1_new</span><span class="p">,</span> <span class="n">S2_new</span><span class="p">,</span> <span class="n">S3_new</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span>
                <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">phase_new</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Set the new values</span>
            <span class="n">S0</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">S0_new</span><span class="p">)</span>
            <span class="n">S1</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">S1_new</span><span class="p">)</span>
            <span class="n">S2</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">S2_new</span><span class="p">)</span>
            <span class="n">S3</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">S3_new</span><span class="p">)</span>
            <span class="n">phase</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">phase_new</span><span class="p">)</span>
            <span class="c1"># Update the object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">),</span> <span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements equality operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Calculate the difference object</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Jones_vector&#39;</span><span class="p">:</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">Stokes</span><span class="p">()</span>
                <span class="n">S</span><span class="o">.</span><span class="n">from_Jones</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="n">j3</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
            <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span><span class="p">:</span>
                <span class="n">j3</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;other is </span><span class="si">{}</span><span class="s1"> instead of Jones_vector or Stokes.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">other</span><span class="o">.</span><span class="n">_type</span><span class="p">))</span>
            <span class="c1"># Compare matrices</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">j3</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
            <span class="n">cond1</span> <span class="o">=</span> <span class="n">norm</span> <span class="o">&lt;</span> <span class="n">tol_default</span>
            <span class="c1"># Compare phases</span>
            <span class="k">if</span> <span class="n">j3</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Check if one of the original phases was different than None</span>
                <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Jones_vector&#39;</span><span class="p">:</span>
                    <span class="n">cond2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">*</span> \
                        <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span><span class="p">:</span>
                    <span class="n">cond2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">*</span> \
                        <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">j3</span><span class="p">,</span> <span class="n">j3</span><span class="o">.</span><span class="n">global_phase</span><span class="p">)</span>
                <span class="n">cond2</span> <span class="o">=</span> <span class="n">j3</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="c1"># Merge conditions</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">cond1</span> <span class="o">*</span> <span class="n">cond2</span>
            <span class="n">new_shape</span> <span class="o">=</span> <span class="n">take_shape</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">new_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cond</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;other is not a py_pol object&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Stokes.update"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function. Checks that the .M dimensions are correct.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If .M is a 1D vector, make it a 2D</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                               <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">3</span><span class="p">]]])</span>
        <span class="c1"># Update number of elements and check that the shape is correct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Phase operations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">,</span> <span class="n">number_types</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Stokes.get_list"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.get_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of 4x1 Stokes vectors.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            out_number (bool): if True and the result is a list of size 1, return a number instead. Default: True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the array is empty, return an empty list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># If desired, return a numpy array</span>
        <span class="k">elif</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span>
        <span class="c1"># Make the list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">S0</span><span class="p">[</span><span class="n">ind</span><span class="p">]],</span> <span class="p">[</span><span class="n">S1</span><span class="p">[</span><span class="n">ind</span><span class="p">]],</span> <span class="p">[</span><span class="n">S2</span><span class="p">[</span><span class="n">ind</span><span class="p">]],</span> <span class="p">[</span><span class="n">S3</span><span class="p">[</span><span class="n">ind</span><span class="p">]]]))</span>
            <span class="k">return</span> <span class="nb">list</span></div>

<div class="viewcode-block" id="Stokes.sum"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.sum">[docs]</a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">change_name</span><span class="o">=</span><span class="n">change_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the sum of Stokes vectors stored in the object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            axis (int, list or tuple): Axes along which the sum is performed. If None, all vectors are summed.</span>
<span class="sd">            keep (bool): if True, the original element is not updated. Default: False.</span>
<span class="sd">            change_name (bool): If True, changes the object name adding Sum of . of at the beggining of the name. Default: True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Jones_matrix): Modified object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_obj</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">create_Stokes</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Simple case</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">N_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">N_axis</span><span class="p">:</span>
            <span class="n">gp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Sum all elements</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">S</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">])</span>
                <span class="n">S</span><span class="o">.</span><span class="n">set_global_phase</span><span class="p">(</span><span class="n">gp</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="n">new_obj</span> <span class="o">=</span> <span class="n">new_obj</span> <span class="o">+</span> <span class="n">S</span>
        <span class="c1"># Complicated case</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate maximum axis</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># Check that the axes are correct</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Axis </span><span class="si">{}</span><span class="s1"> greater than the number of dimensions of </span><span class="si">{}</span><span class="s1">, which is </span><span class="si">{}</span><span class="s1">&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
            <span class="c1"># Calculate shapes, sizes and indices</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">shape_removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape_removed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="n">axis</span><span class="p">]</span>
            <span class="n">N_removed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape_removed</span><span class="p">)</span>
            <span class="n">ind_removed</span> <span class="o">=</span> <span class="n">combine_indices</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N_removed</span><span class="p">)),</span> <span class="n">shape_removed</span><span class="p">))</span>
            <span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
            <span class="n">N_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape_matrix</span><span class="p">)</span>
            <span class="n">ind_matrix</span> <span class="o">=</span> <span class="n">combine_indices</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N_matrix</span><span class="p">)),</span> <span class="n">shape_matrix</span><span class="p">))</span>
            <span class="n">shape_final</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape_matrix</span><span class="p">)</span>
            <span class="n">axes_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">shape_orig</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="c1"># Prealocate memory</span>
            <span class="n">M_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">shape_orig</span><span class="p">)</span>
            <span class="n">phase_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape_final</span><span class="p">)</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape_final</span><span class="p">)</span>
            <span class="c1"># Make the for loop of the matrix to be calculated</span>
            <span class="k">for</span> <span class="n">indM</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_matrix</span><span class="p">):</span>
                <span class="c1"># Prepare the Stokes vector to sum</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">merge_indices</span><span class="p">(</span><span class="n">ind_matrix</span><span class="p">[</span><span class="n">indM</span><span class="p">],</span> <span class="n">ind_removed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="p">)</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">multitake</span><span class="p">(</span><span class="n">M_orig</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">axes_aux</span><span class="p">))</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">set_global_phase</span><span class="p">(</span><span class="n">phase_orig</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">indices</span><span class="p">)])</span>
                <span class="c1"># Make the summation loop</span>
                <span class="k">for</span> <span class="n">indR</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_removed</span><span class="p">):</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">merge_indices</span><span class="p">(</span><span class="n">ind_matrix</span><span class="p">[</span><span class="n">indM</span><span class="p">],</span>
                                            <span class="n">ind_removed</span><span class="p">[</span><span class="n">indR</span><span class="p">],</span> <span class="n">axis</span><span class="p">)</span>
                    <span class="n">S</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">multitake</span><span class="p">(</span><span class="n">M_orig</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">axes_aux</span><span class="p">))</span>
                    <span class="n">S</span><span class="o">.</span><span class="n">set_global_phase</span><span class="p">(</span><span class="n">phase_orig</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">indices</span><span class="p">)])</span>
                    <span class="n">new_obj</span> <span class="o">=</span> <span class="n">new_obj</span> <span class="o">+</span> <span class="n">S</span>
                <span class="c1"># Store the result</span>
                <span class="n">ind_aux</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">ind_matrix</span><span class="p">[</span><span class="n">indM</span><span class="p">]))</span>
                <span class="n">M</span><span class="p">[</span><span class="n">ind_aux</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">ind_aux</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">ind_matrix</span><span class="p">[</span><span class="n">indM</span><span class="p">]))</span>
                <span class="n">M</span><span class="p">[</span><span class="n">ind_aux</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">ind_aux</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">ind_matrix</span><span class="p">[</span><span class="n">indM</span><span class="p">]))</span>
                <span class="n">M</span><span class="p">[</span><span class="n">ind_aux</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">ind_aux</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">ind_matrix</span><span class="p">[</span><span class="n">indM</span><span class="p">]))</span>
                <span class="n">M</span><span class="p">[</span><span class="n">ind_aux</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">ind_aux</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ind_matrix</span><span class="p">[</span><span class="n">indM</span><span class="p">])</span>
                <span class="n">phase</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">()</span>
            <span class="c1"># Create the object and return it</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">set_global_phase</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Sum of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">keep</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="n">new_obj</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

<div class="viewcode-block" id="Stokes.flip"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.flip">[docs]</a>    <span class="k">def</span> <span class="nf">flip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">change_name</span><span class="o">=</span><span class="n">change_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Flips the elements stored in the object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            axis (int, list or tuple): Axes along which the flip is performed. If None, the object is flipped as flattened. Default: None.</span>
<span class="sd">            keep (bool): if True, the original element is not updated. Default: False.</span>
<span class="sd">            change_name (bool): If True, changes the object name adding Recip. of at the beggining of the name. Default: True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Jones_vector): Modified object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Simple case</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_list</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">new_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">new_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Divide in components</span>
            <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">()</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Flip each one individually</span>
            <span class="n">S0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">S1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">S2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">S2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">S3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">S3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
            <span class="c1"># Use them to create the new object</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">),</span> <span class="n">global_phase</span><span class="o">=</span><span class="n">phase</span><span class="p">)</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="c1"># End operations</span>
        <span class="k">if</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Flip of &#39;</span> <span class="o">+</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

    <span class="c1"># @_actualize_</span>
<div class="viewcode-block" id="Stokes.rotate"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">change_name</span><span class="o">=</span><span class="n">change_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rotates a jones vector a certain angle.</span>

<span class="sd">        M_rotated = rotation_matrix_Jones(-angle) * self.M</span>

<span class="sd">        Parameters:</span>
<span class="sd">            angle (float): Rotation angle in radians.</span>
<span class="sd">            keep (bool): If True, the original element is not updated. Default: False.</span>
<span class="sd">            change_name (bool): If True and angle is of size 1, changes the object name adding @ XX deg, being XX the total rotation angle. Default: True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Jones_vector): Rotated object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Prepare variables</span>
        <span class="n">angle</span><span class="p">,</span> <span class="n">new_obj</span><span class="p">,</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">([</span><span class="n">angle</span><span class="p">],</span>
                                                      <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">],</span>
                                                      <span class="n">obj</span><span class="o">=</span><span class="n">new_obj</span><span class="p">,</span>
                                                      <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Calculate the array of rotation matrices</span>
        <span class="n">Mrot</span> <span class="o">=</span> <span class="n">rotation_matrix_Mueller</span><span class="p">(</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span>
        <span class="c1"># The 1-D case is much simpler. Differenciate it.</span>
        <span class="k">if</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">angle</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">Mrot</span><span class="p">)</span> <span class="o">@</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">M</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Move axes of the variables to allow multiplication</span>
            <span class="n">Mrot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">Mrot</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Multiply</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">Mrot</span> <span class="o">@</span> <span class="n">S</span>
            <span class="c1"># Reshape again to accomodate to our way of representing elements</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">S</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Update</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">global_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">)</span>
        <span class="c1"># Update name if required</span>
        <span class="k">if</span> <span class="n">change_name</span> <span class="ow">and</span> <span class="n">angle</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> \
                    <span class="s2">&quot; @ </span><span class="si">{:1.2f}</span><span class="s2"> deg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">degrees</span><span class="p">)</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">repair_name</span><span class="p">(</span><span class="n">new_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="n">new_obj</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

    <span class="c1"># @_actualize_</span>
<div class="viewcode-block" id="Stokes.set_depolarization"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.set_depolarization">[docs]</a>    <span class="k">def</span> <span class="nf">set_depolarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">degree_pol</span><span class="p">,</span>
                           <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">ratio</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                           <span class="n">keep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">change_name</span><span class="o">=</span><span class="n">change_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that reduces de polarization degree of a Stokes vector among the three last components.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            degree_pol (float) [0, 1]: Polarization degree.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            ratio (np.array): Ratio between the three components of the depolarization degree. When different from [1, 1, 1]. Default: [1, 1, 1].</span>
<span class="sd">            keep (bool): if True, the original element is not updated. Default: False.</span>
<span class="sd">            change_name (bool): If True, changes the object name adding Normalized of at the end of the name. Default: True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Prepare variables</span>
        <span class="p">(</span><span class="n">degree_pol</span><span class="p">),</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">degree_pol</span><span class="p">],</span>
                                                    <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">],</span>
                                                    <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                    <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Extract the components and the current polarization degree</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">degree_pol_prov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">S0</span>
        <span class="c1"># Calculate the proportionallity coefficients</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">degree_pol_prov</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">degree_pol_prov</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">degree_pol_prov</span>
        <span class="c1"># Calculate the object</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">c1</span><span class="p">,</span> <span class="n">S2</span> <span class="o">*</span> <span class="n">c2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">*</span> <span class="n">c3</span><span class="p">))</span>
        <span class="c1"># End operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; depolarized&#39;</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

<div class="viewcode-block" id="Stokes.add_depolarization"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.add_depolarization">[docs]</a>    <span class="k">def</span> <span class="nf">add_depolarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">degree_pol</span><span class="p">,</span>
                           <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">ratio</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                           <span class="n">keep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">change_name</span><span class="o">=</span><span class="n">change_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that reduces de polarization degree of a Stokes vector among the three last components.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            degree_pol (float) [0, 1]: Polarization degree.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            ratio (np.array): Ratio between the three components of the depolarization degree. When different from [1, 1, 1]. Default: [1, 1, 1].</span>
<span class="sd">            keep (bool): if True, the original element is not updated. Default: False.</span>
<span class="sd">            change_name (bool): If True, changes the object name adding Normalized of at the end of the name. Default: True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Prepare variables</span>
        <span class="p">(</span><span class="n">degree_pol</span><span class="p">),</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">degree_pol</span><span class="p">],</span>
                                                    <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">],</span>
                                                    <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                    <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Calculate the new polarization degree</span>
        <span class="n">degree_pol_old</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">degree_pol</span> <span class="o">+</span> <span class="n">degree_pol_old</span>
        <span class="n">degree_pol</span><span class="p">[</span><span class="n">degree_pol</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">degree_pol</span><span class="p">[</span><span class="n">degree_pol</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Set the new polarization degree</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">set_depolarization</span><span class="p">(</span><span class="n">degree_pol</span><span class="o">=</span><span class="n">degree_pol</span><span class="p">)</span>
        <span class="c1"># End operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; depolarized&#39;</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

<div class="viewcode-block" id="Stokes.normalize"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">change_name</span><span class="o">=</span><span class="n">change_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that normalizes the Stokes vectors to have Intensity = 1.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            keep (bool): if True, the original element is not updated. Default: False.</span>
<span class="sd">            change_name (bool): If True, changes the object name adding Normalized of at the end of the name. Default: True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Calculate the normalized components</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="p">(</span><span class="n">S1</span> <span class="o">/</span> <span class="n">S0</span><span class="p">,</span> <span class="n">S2</span> <span class="o">/</span> <span class="n">S0</span><span class="p">,</span> <span class="n">S3</span> <span class="o">/</span> <span class="n">S0</span><span class="p">)</span>
        <span class="c1"># Avoid dividing by 0</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">))</span>
        <span class="c1"># End operations</span>
        <span class="k">if</span> <span class="n">change_names</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; normalized&#39;</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

<div class="viewcode-block" id="Stokes.clear"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes all data from the Stokes object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">Stokes</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Stokes.copy"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a copy of the object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            N (int): Number of copies. Default: 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes or list): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">S</span></div>

<div class="viewcode-block" id="Stokes.stretch"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.stretch">[docs]</a>    <span class="k">def</span> <span class="nf">stretch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that stretches the object to have a higher number of equal elements.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            length (int): Number of elements. Default: 1.</span>
<span class="sd">            keep (bool): If True, self is not updated. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Jones_vector): Recalculated Stokes vectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Act only if neccessary</span>
        <span class="k">if</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">()</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span>
                <span class="p">(</span><span class="n">S0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">),</span>
                 <span class="n">S2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="n">S3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">)))</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

<div class="viewcode-block" id="Stokes.add_global_phase"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.add_global_phase">[docs]</a>    <span class="k">def</span> <span class="nf">add_global_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">phase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">unknown_as_zero</span><span class="o">=</span><span class="n">unknown_phase</span><span class="p">,</span>
                         <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that adds a phase to the Stokes object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            phase (float or np.ndarray): Phase to be added to the Stokes vectors. Default: 0.</span>
<span class="sd">            unknown_as_zero (bool): If True, takes unknown phase as zero. Default: False.</span>
<span class="sd">            keep (bool): If True, self is not updated. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Recalculated Stokes object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Prepare variables</span>
        <span class="n">phase</span><span class="p">,</span> <span class="n">new_obj</span><span class="p">,</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">([</span><span class="n">phase</span><span class="p">],</span>
                                                      <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">],</span>
                                                      <span class="n">obj</span><span class="o">=</span><span class="n">new_obj</span><span class="p">,</span>
                                                      <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="c1"># Add the phase</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unknown_as_zero</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">+</span> <span class="n">phase</span>
        <span class="c1"># End</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="n">new_obj</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

<div class="viewcode-block" id="Stokes.set_global_phase"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.set_global_phase">[docs]</a>    <span class="k">def</span> <span class="nf">set_global_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">phase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that sets the phase to the Stokes object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            phase (float or np.ndarray): Phase to be added to the Stokes vectors. Default: 0.</span>
<span class="sd">            keep (bool): If True, self is not updated. Default: False.</span>
<span class="sd">            length (int): If amplitude and azimuth are not specified, it is created a 4 x length array of jones vectors. Default: 1.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Recalculated Stokes object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># If None or Nan, skip some steps</span>
        <span class="k">if</span> <span class="n">phase</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">phase</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Prepare variables</span>
            <span class="n">phase</span><span class="p">,</span> <span class="n">new_obj</span><span class="p">,</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">([</span><span class="n">phase</span><span class="p">],</span>
                                                          <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">],</span>
                                                          <span class="n">obj</span><span class="o">=</span><span class="n">new_obj</span><span class="p">,</span>
                                                          <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                          <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="n">new_obj</span><span class="p">,</span>
                                                       <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                                       <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                                       <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="c1"># End</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

<div class="viewcode-block" id="Stokes.remove_global_phase"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.remove_global_phase">[docs]</a>    <span class="k">def</span> <span class="nf">remove_global_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that removes the phase to the Stokes object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            keep (bool): If True, self is not updated. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Recalculated Stokes object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Set the phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="n">default_phase</span>
        <span class="c1"># End</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

<div class="viewcode-block" id="Stokes.rotate_to_azimuth"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.rotate_to_azimuth">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_to_azimuth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">azimuth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that rotates the Stokes vectors to have a certain azimuth.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            azimuth (string or np.ndarray): Azimuth of the Stokes vectors. &#39;X&#39;, &#39;Y&#39;, &#39;-X&#39; and &#39;-Y&#39; are the same as 0, 90, 180 and 270 degrees respectively. Default: 0.</span>
<span class="sd">            keep (bool): If True, self is not updated. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Jones_vector): Normalized Stokes vectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Translate the valid strings</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">azimuth</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">azimuth</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="n">azimuth</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">azimuth</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">):</span>
                <span class="n">azimuth</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">*</span> <span class="n">degrees</span>
            <span class="k">elif</span> <span class="n">azimuth</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;-X&#39;</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">):</span>
                <span class="n">azimuth</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">degrees</span>
            <span class="k">elif</span> <span class="n">azimuth</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;-Y&#39;</span><span class="p">,</span> <span class="s1">&#39;-y&#39;</span><span class="p">):</span>
                <span class="n">azimuth</span> <span class="o">=</span> <span class="mi">270</span> <span class="o">*</span> <span class="n">degrees</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Prepare variables</span>
        <span class="n">azimuth</span><span class="p">,</span> <span class="n">new_obj</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">([</span><span class="n">azimuth</span><span class="p">],</span>
                                             <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">],</span>
                                             <span class="n">obj</span><span class="o">=</span><span class="n">new_obj</span><span class="p">)</span>
        <span class="c1"># Calculate the new vector</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">intensity</span><span class="p">()</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ellipticity_angle</span><span class="p">()</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">general_azimuth_ellipticity</span><span class="p">(</span><span class="n">azimuth</span><span class="o">=</span><span class="n">azimuth</span><span class="p">,</span>
                                            <span class="n">ellipticity</span><span class="o">=</span><span class="n">el</span><span class="p">,</span>
                                            <span class="n">intensity</span><span class="o">=</span><span class="n">I</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">new_obj</span></div>

    <span class="c1">###########################################################################</span>
    <span class="c1"># Creation</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="Stokes.from_components"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.from_components">[docs]</a>    <span class="k">def</span> <span class="nf">from_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">components</span><span class="p">,</span>
                        <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">global_phase</span><span class="o">=</span><span class="n">default_phase</span><span class="p">,</span>
                        <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Stokes vectors directly from the 4 elements [s0, s1, s2, s3]</span>

<span class="sd">        Parameters:</span>
<span class="sd">            components (tuple): A 4 element tuple containing the 4 components of the Stokes vectors (S0, S1, S2, S3).</span>
<span class="sd">            degree_pol (float) [0, 1]: Polarization degree.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            global_phase (numpy.ndarray): Adds a global phase to the Stokes object. Default: 0.</span>
<span class="sd">            length (int): If amplitude and azimuth are not specified, it is created a 4 x length array of jones vectors. Default: 1.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Created object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Prepare variables</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">components</span>
        <span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">),</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">(</span>
            <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">],</span>
            <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
            <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">S0</span><span class="p">,</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">S1</span><span class="p">,</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">S2</span><span class="p">,</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">S3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">S0</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_global_phase</span><span class="p">(</span><span class="n">global_phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Stokes.from_matrix"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.from_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">from_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">M</span><span class="p">,</span>
                    <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">global_phase</span><span class="o">=</span><span class="n">default_phase</span><span class="p">,</span>
                    <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a Stokes object from an external array.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            M (numpy.ndarray): New matrix. At least one dimension must be of size 4.</span>
<span class="sd">            degree_pol (float) [0, 1]: Polarization degree.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            global_phase (numpy.ndarray): Adds a global phase to the Stokes object. Default: 0.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Created object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the matrix is of the correct Size</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">size</span>
        <span class="c1"># Case 1D</span>
        <span class="k">if</span> <span class="n">M</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">M</span><span class="o">.</span><span class="n">size</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)))</span>
                <span class="n">new_shape</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;M must have a number of elements multiple off 4.&#39;</span><span class="p">)</span>
        <span class="c1"># Case 2D</span>
        <span class="k">elif</span> <span class="n">M</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                    <span class="n">new_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;The Stokes vectors must be a 4xN or Nx4 array. Current shape is </span><span class="si">{}</span><span class="s1">&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="c1"># Case 3+D</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sh</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">:</span>
                <span class="c1"># Store the shape of the desired outputs</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">sh</span> <span class="o">==</span> <span class="mi">4</span><span class="p">))</span>
                <span class="c1"># Store info</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="p">])</span>
                <span class="n">new_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;The matrix must have one axis with exactly 4 elements&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="c1"># End operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="c1"># Add global phase and depolarization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_global_phase</span><span class="p">(</span><span class="n">global_phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_depolarization</span><span class="p">(</span><span class="n">degree_pol</span><span class="o">=</span><span class="n">degree_pol</span><span class="p">,</span>
                                <span class="n">degree_depol</span><span class="o">=</span><span class="n">degree_depol</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Stokes.from_list"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.from_list">[docs]</a>    <span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">l</span><span class="p">,</span>
                  <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">global_phase</span><span class="o">=</span><span class="n">default_phase</span><span class="p">,</span>
                  <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a Stokes object from a list of size 4 or 4x1 numpy arrays.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            l (list): list of matrices.</span>
<span class="sd">            degree_pol (float) [0, 1]: Polarization degree.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            global_phase (numpy.ndarray): Adds a global phase to the Stokes object. Default: 0.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Created object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Preallocate memory</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
        <span class="c1"># Fill it</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="n">M</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="c1"># Update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span>
                         <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                         <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                         <span class="n">degree_pol</span><span class="o">=</span><span class="n">degree_pol</span><span class="p">,</span>
                         <span class="n">degree_depol</span><span class="o">=</span><span class="n">degree_depol</span><span class="p">,</span>
                         <span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Stokes.from_distribution"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.from_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">from_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">Ex</span><span class="p">,</span>
                          <span class="n">Ey</span><span class="p">,</span>
                          <span class="n">ind_d</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">method</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span>
                          <span class="n">N_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the Stokes vectors from a temporal or spatial electric field distribution [(Ex(t), Ey(t)].</span>

<span class="sd">        Parameters:</span>
<span class="sd">            Ex (numpy.ndarray or float): X component of the electric field</span>
<span class="sd">            Ey (numpy.ndarray or float): Y component of the electric field</span>
<span class="sd">            ind_d (int): Index of the spatial or temporal dimension. Default: -1.</span>
<span class="sd">            method (string): Method for calculating the field amplitude and delay: DIRECT or FIT. Default: direct.</span>
<span class="sd">            N_periods (float): Number of periods in the representation data. It is used by the fit algorithm (real case only) for calculating the frequency. If the value is not exact, convergency may decrease. Default: 1.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Jones_vector): Created object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Measure sizes, dims, etc</span>
        <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ex</span><span class="p">)</span>
        <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ey</span><span class="p">)</span>
        <span class="n">dimsX</span><span class="p">,</span> <span class="n">dimsY</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ex</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="n">Ey</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dimsX</span><span class="p">,</span> <span class="n">dimsY</span><span class="p">)</span>
        <span class="n">shapeX</span><span class="p">,</span> <span class="n">shapeY</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ex</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ey</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ex</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">Ey</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">new_shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Check that the data is compatible</span>
        <span class="k">if</span> <span class="n">Nx</span> <span class="o">!=</span> <span class="n">Ny</span> <span class="ow">and</span> <span class="n">dimsX</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">dimsY</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Ex and Ey components must have the same number of elements&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Nx</span> <span class="o">!=</span> <span class="n">Ny</span> <span class="ow">and</span> <span class="n">dimsX</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">dimsY</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Ex and Ey components must have the same number of elements&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dimsX</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">shapeY</span><span class="p">[</span><span class="n">ind_d</span><span class="p">]</span> <span class="o">==</span> <span class="n">Nx</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Number of elements of X and Y components does not match&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dimsY</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">shapeX</span><span class="p">[</span><span class="n">ind_d</span><span class="p">]</span> <span class="o">==</span> <span class="n">Ny</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Number of elements of X and Y components does not match&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">shapeX</span><span class="p">[</span><span class="n">ind_d</span><span class="p">]</span> <span class="o">!=</span> <span class="n">shapeY</span><span class="p">[</span><span class="n">ind_d</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Temporal dimension of X and Y components does not match&#39;</span><span class="p">)</span>
        <span class="c1"># Check if the variables are real or complex</span>
        <span class="n">complex_X</span> <span class="o">=</span> <span class="n">Ex</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;complex128&#39;</span><span class="p">)</span>
        <span class="n">complex_Y</span> <span class="o">=</span> <span class="n">Ey</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;complex128&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">complex_X</span> <span class="o">==</span> <span class="n">complex_Y</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Both Ex and Ey must be in the same representation type: real or complex&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Prepare the data as a 2D arrays</span>
        <span class="k">if</span> <span class="n">dimsX</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Nt</span> <span class="o">=</span> <span class="n">shapeX</span><span class="p">[</span><span class="n">ind_d</span><span class="p">]</span>
            <span class="n">NelemX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nx</span> <span class="o">/</span> <span class="n">Nt</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">complex_X</span><span class="p">:</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span> <span class="n">NelemX</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span> <span class="n">NelemX</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="p">):</span>
                <span class="n">ex</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">Ex</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ind_d</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">new_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">shapeX</span><span class="p">,</span> <span class="n">ind_d</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Nt</span> <span class="o">=</span> <span class="n">Nx</span>
            <span class="n">NelemX</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ex</span><span class="p">,</span> <span class="p">(</span><span class="n">Nt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">dimsY</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">NelemY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ny</span> <span class="o">/</span> <span class="n">Nt</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">complex_X</span><span class="p">:</span>
                <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span> <span class="n">NelemY</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span> <span class="n">NelemY</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="p">):</span>
                <span class="n">ey</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">Ey</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ind_d</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dimsY</span> <span class="o">&gt;</span> <span class="n">dimsX</span><span class="p">:</span>
                <span class="n">new_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">shapeY</span><span class="p">,</span> <span class="n">ind_d</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ey</span><span class="p">,</span> <span class="p">(</span><span class="n">Nt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">NelemY</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Calculate</span>
        <span class="k">if</span> <span class="n">complex_X</span><span class="p">:</span>
            <span class="c1"># Amplitude here is easy to extract</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="s1">&#39;FIT&#39;</span><span class="p">,</span> <span class="s1">&#39;Fit&#39;</span><span class="p">):</span>
                <span class="c1"># Use the mean for polarized amplitude</span>
                <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># Use variance for unpolarized intensity</span>
                <span class="n">dIx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">dIy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># Fit the phase</span>
                <span class="n">phaseX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">phaseY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">ey</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">phaseX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">phaseX</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">phaseY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">phaseY</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># Calculate the components</span>
                <span class="n">S0</span> <span class="o">=</span> <span class="n">Ex</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ey</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dIx</span> <span class="o">+</span> <span class="n">dIy</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">S1</span> <span class="o">=</span> <span class="n">Ex</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Ey</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">S2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ex</span> <span class="o">*</span> <span class="n">Ey</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phaseY</span> <span class="o">-</span> <span class="n">phaseX</span><span class="p">)</span>
                <span class="n">S3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Ex</span> <span class="o">*</span> <span class="n">Ey</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phaseY</span> <span class="o">-</span> <span class="n">phaseX</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Use the average values</span>
                <span class="n">S0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">+</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
                <span class="n">S1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">-</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
                <span class="n">S2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ex</span> <span class="o">*</span> <span class="n">ey</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
                <span class="n">S3</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ex</span> <span class="o">*</span> <span class="n">ey</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">imag</span>
                <span class="n">phaseX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Real evolution according to cos(k*x) or cos(w*t). Start by calculating the direct values</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">phaseX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">Ex</span><span class="p">)</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">phaseX</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">phaseX</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
            <span class="n">phaseY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">Ey</span><span class="p">)</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">ey</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="n">ey</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">phaseY</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">phaseY</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
            <span class="c1"># If using fit, use those values as first guess</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="s1">&#39;FIT&#39;</span><span class="p">,</span> <span class="s1">&#39;Fit&#39;</span><span class="p">):</span>
                <span class="c1"># Prepare variables for X fit</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">zero</span><span class="p">,</span> <span class="n">one</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
                <span class="n">cte</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">N_periods</span> <span class="o">/</span> <span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">par0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">phaseX</span><span class="p">,</span> <span class="n">one</span> <span class="o">*</span> <span class="n">cte</span><span class="p">,</span> <span class="n">Ex</span><span class="p">))</span>
                <span class="n">min_limit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">))</span>
                <span class="n">max_limit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">one</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">one</span><span class="p">,</span> <span class="n">Ex</span><span class="p">))</span>
                <span class="c1"># X fit</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">fit_distribution</span><span class="p">,</span>
                                                <span class="n">par0</span><span class="p">,</span>
                                                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                                <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">min_limit</span><span class="p">,</span> <span class="n">max_limit</span><span class="p">))</span>
                <span class="n">phaseX</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="n">s</span><span class="p">]</span>
                <span class="n">Ex</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="p">:]</span>
                <span class="n">dIx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># prepare variables for Y fit</span>
                <span class="n">par0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">phaseY</span><span class="p">,</span> <span class="n">one</span> <span class="o">*</span> <span class="n">cte</span><span class="p">,</span> <span class="n">Ey</span><span class="p">))</span>
                <span class="n">max_limit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">one</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">one</span><span class="p">,</span> <span class="n">Ey</span><span class="p">))</span>
                <span class="c1"># Y fit</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">fit_distribution</span><span class="p">,</span>
                                                <span class="n">par0</span><span class="p">,</span>
                                                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ey</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                                <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">min_limit</span><span class="p">,</span> <span class="n">max_limit</span><span class="p">))</span>
                <span class="n">phaseY</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="n">s</span><span class="p">]</span>
                <span class="n">Ey</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="p">:]</span>
                <span class="n">dIy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span> <span class="n">ey</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Without fit, it is impossible to asses the unpolarized part</span>
                <span class="n">dIx</span><span class="p">,</span> <span class="n">dIy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Calculate the components</span>
            <span class="n">S0</span> <span class="o">=</span> <span class="n">Ex</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ey</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dIx</span> <span class="o">+</span> <span class="n">dIy</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">S1</span> <span class="o">=</span> <span class="n">Ex</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Ey</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">S2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ex</span> <span class="o">*</span> <span class="n">Ey</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phaseY</span> <span class="o">-</span> <span class="n">phaseX</span><span class="p">)</span>
            <span class="n">S3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Ex</span> <span class="o">*</span> <span class="n">Ey</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phaseY</span> <span class="o">-</span> <span class="n">phaseX</span><span class="p">)</span>
        <span class="c1"># Create the object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">),</span> <span class="n">global_phase</span><span class="o">=</span><span class="n">phaseX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Stokes.from_Jones"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.from_Jones">[docs]</a>    <span class="k">def</span> <span class="nf">from_Jones</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">E</span><span class="p">,</span>
                   <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a Stokes object from a Stokes vectors object or a matrix corresponding to a Stokes vectors.</span>

<span class="sd">        .. math:: s_0 = abs(E_x)^2 + abs(E_y)^2</span>

<span class="sd">        .. math:: s_1 = (abs(E_x)^2 - abs(E_y)^2)   p_1</span>

<span class="sd">        .. math:: s_2 = 2  real(E_x  E_y^*)   p_1</span>

<span class="sd">        .. math:: s_3 = -2  imag(E_x  E_y^*)   p_2</span>


<span class="sd">        Parameters:</span>
<span class="sd">            E (Jones_vector object): Stokes vectors.</span>
<span class="sd">            degree_pol (float or numpy.ndarray): Degree of polarization of the new Stokes vector. Default: 1.</span>
<span class="sd">            length (int): If final object is of size 1, it is stretched to match this size. Default: 1.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Created object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Prepare variables</span>
        <span class="p">(</span><span class="n">degree_pol</span><span class="p">),</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">degree_pol</span><span class="p">],</span>
                                                    <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">],</span>
                                                    <span class="n">length</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
                                                    <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Calculate electric field components</span>
        <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Calculate the Stokes vector</span>
        <span class="n">S0</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">intensity</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">S1</span> <span class="o">=</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ex</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ey</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">S2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ex</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ey</span><span class="p">))</span>
        <span class="n">S3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ex</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ey</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">))</span>
        <span class="c1"># Select final shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">E</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># @_actualize_</span>
    <span class="c1"># def from_distribution(self, E, is_normalized=False):</span>
    <span class="c1">#     &quot;&quot;&quot;Creates Stokes vectors from a [Ex(t), Ey(t)] electric field.</span>
    <span class="c1">#</span>
    <span class="c1">#     Parameters:</span>
    <span class="c1">#         E (numpy.array): [Ex(t), Ey(t)]</span>
    <span class="c1">#         is_normalized (bool): If True intensity is normalized</span>
    <span class="c1">#</span>
    <span class="c1">#     Returns:</span>
    <span class="c1">#         S (4x1 numpy.matrix): Stokes vector (I, Q, U, V).</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     Ex, Ey = E[:, 0], E[:, 1]</span>
    <span class="c1">#</span>
    <span class="c1">#     S = np.matrix(np.array([[0.0], [0.0], [0.0], [0.0]]))</span>
    <span class="c1">#     S[0] = (np.conjugate(Ex) * Ex + np.conjugate(Ey) * Ey).mean().real</span>
    <span class="c1">#     S[1] = (np.conjugate(Ex) * Ex - np.conjugate(Ey) * Ey).mean().real</span>
    <span class="c1">#     S[2] = 2 * (Ex * np.conjugate(Ey)).mean().real</span>
    <span class="c1">#     # S[2] = (Ex * np.conjugate(Ey)+Ey*np.conjugate(Ex)).mean().real</span>
    <span class="c1">#     S[3] = -2 * (Ex * np.conjugate(Ey)).mean().imag</span>
    <span class="c1">#     # S[3] = (1j*(Ex * np.conjugate(Ey)-Ey*np.conjugate(Ex)).mean()).real</span>
    <span class="c1">#</span>
    <span class="c1">#     if is_normalized:</span>
    <span class="c1">#         S = S / S[0]</span>
    <span class="c1">#</span>
    <span class="c1">#     self.from_matrix(S)</span>
    <span class="c1">#</span>
    <span class="c1"># # @_actualize_</span>
    <span class="c1"># def from_distribution_deprecated(self, E, is_normalized=False):</span>
    <span class="c1">#     &quot;&quot;&quot;Creates Stokes vectors from a [Ex(t), Ey(t)] electric field.</span>
    <span class="c1">#</span>
    <span class="c1">#     Parameters:</span>
    <span class="c1">#         E (numpy.array): [Ex(t), Ey(t)]</span>
    <span class="c1">#         is_normalized (bool): If True intensity is normalized</span>
    <span class="c1">#</span>
    <span class="c1">#     Returns:</span>
    <span class="c1">#         S (4x1 numpy.matrix): Stokes vector (I, Q, U, V).</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     Ex, Ey = E[0], E[1]</span>
    <span class="c1">#</span>
    <span class="c1">#     if is_normalized is True:</span>
    <span class="c1">#         intensity = np.sqrt(np.conjugate(Ex) * Ex + np.conjugate(Ey) * Ey)</span>
    <span class="c1">#         Ex = Ex / intensity</span>
    <span class="c1">#         Ey = Ey / intensity</span>
    <span class="c1">#</span>
    <span class="c1">#     S = np.matrix(np.array([[0.0], [0.0], [0.0], [0.0]]))</span>
    <span class="c1">#     S[0] = (np.conjugate(Ex) * Ex + np.conjugate(Ey) * Ey).mean.real</span>
    <span class="c1">#     S[1] = (np.conjugate(Ex) * Ex - np.conjugate(Ey) * Ey).real</span>
    <span class="c1">#     S[2] = 2 * (Ex * np.conjugate(Ey)).real</span>
    <span class="c1">#     S[3] = 2 * (Ex * np.conjugate(Ey)).imag</span>
    <span class="c1">#     self.from_matrix(S)</span>

    <span class="c1"># # @_actualize_</span>
    <span class="c1"># def to_Jones(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Function that converts Stokes light states to Jones states.</span>
    <span class="c1">#</span>
    <span class="c1">#     Returns:</span>
    <span class="c1">#         j (Jones_vector object): Stokes state.&quot;&quot;&quot;</span>
    <span class="c1">#     j = Jones_vector(self.name)</span>
    <span class="c1">#     j.from_Stokes(self)</span>
    <span class="c1">#     return j</span>

<div class="viewcode-block" id="Stokes.linear_light"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.linear_light">[docs]</a>    <span class="k">def</span> <span class="nf">linear_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">azimuth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">amplitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">global_phase</span><span class="o">=</span><span class="n">default_phase</span><span class="p">,</span>
                     <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a Stokes vector of linear polarizer light.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            intensity (numpy.array or float): Array of intensity. Default: 1.</span>
<span class="sd">            azimuth (numpy.array or float): Array of azimuths. Default: 0.</span>
<span class="sd">            amplitude (numpy.array or float): Array of electric field amplitude. Overrides inetnsity if it is different than None. Default: None.</span>
<span class="sd">            degree_pol (numpy.array or float): Array of polarization degree. Default: 1.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            global_phase (float or numpy.ndarray): Adds a global phase to the Stokes object. Default: default_phase.</span>
<span class="sd">            length (int): If final object is of size 1, it is stretched to match this size. Default: 1.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Created object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Use amplitude if specified</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># Prepare variables</span>
        <span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">),</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">(</span>
            <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">intensity</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">],</span>
            <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
            <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Calculate the vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">intensity</span><span class="p">,</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">intensity</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                             <span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">)</span>
        <span class="c1"># Rotate it to the desired angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="n">azimuth</span><span class="p">)</span>
        <span class="c1"># Store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># @_actualize_</span>
<div class="viewcode-block" id="Stokes.circular_light"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.circular_light">[docs]</a>    <span class="k">def</span> <span class="nf">circular_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span>
                       <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">amplitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">global_phase</span><span class="o">=</span><span class="n">default_phase</span><span class="p">,</span>
                       <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Stokes vectors for pure circular polarizer light</span>

<span class="sd">        Parameters:</span>
<span class="sd">            kind (str): &#39;d&#39;,&#39;r&#39; - right, dextro.</span>
<span class="sd">                        &#39;l&#39;, &#39;i&#39; - left, levo.</span>
<span class="sd">            intensity (numpy.array or float): Array of intensity. Default: 1.</span>
<span class="sd">            amplitude (numpy.array or float): Array of electric field amplitude. Overrides inetnsity if it is different than None. Default: None.</span>
<span class="sd">            degree_pol (numpy.array or float): Array of polarization degree. Default: 1.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            global_phase (float or numpy.ndarray): Adds a global phase to the Stokes object. Default: default_phase.</span>
<span class="sd">            length (int): If final object is of size 1, it is stretched to match this size. Default: 1.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Created object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use the correct sign</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="s1">&#39;drDR&#39;</span><span class="p">:</span>  <span class="c1"># derecha, right</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="ow">in</span> <span class="s1">&#39;ilIL&#39;</span><span class="p">:</span>  <span class="c1"># izquierda, left</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kind is </span><span class="si">{}</span><span class="s1"> instead of I, L, D or R&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kind</span><span class="p">))</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Use amplitude if specified</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># Prepare variables</span>
        <span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">),</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">(</span>
            <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">intensity</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">],</span>
            <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
            <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Calculate the vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">intensity</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">intensity</span><span class="p">),</span>
                             <span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">)</span>
        <span class="c1"># Store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># @_actualize_</span>
<div class="viewcode-block" id="Stokes.elliptical_light"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.elliptical_light">[docs]</a>    <span class="k">def</span> <span class="nf">elliptical_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                         <span class="n">azimuth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">global_phase</span><span class="o">=</span><span class="n">default_phase</span><span class="p">,</span>
                         <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stokes object of the most general light calculated from the polarization ellipse parameters.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            a (numpy.array or float): Array of electric amplitude of x axis. Default: 1.</span>
<span class="sd">            b (numpy.array or float): Array of electric amplitude of y axis. Default: 1.</span>
<span class="sd">            kind (str): &#39;d&#39;,&#39;r&#39; - right, dextro.</span>
<span class="sd">                        &#39;l&#39;, &#39;i&#39; - left, levo.</span>
<span class="sd">            azimuth (numpy.array or float): Angle of the a axis respect to the x axis. Default: 0.</span>
<span class="sd">            degree_pol (float) [0, 1]: Polarization degree.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            global_phase (float or numpy.ndarray): Adds a global phase to the Stokes object. Default: default_phase.</span>
<span class="sd">            length (int): If final object is of size 1, it is stretched to match this size. Default: 1.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Stokes): Created object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Calculate it as Stokes vectors (much easier)</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">Jones_vector</span><span class="p">()</span>
        <span class="n">J</span><span class="o">.</span><span class="n">elliptical_light</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                           <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
                           <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                           <span class="n">azimuth</span><span class="o">=</span><span class="n">azimuth</span><span class="p">,</span>
                           <span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">,</span>
                           <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
                           <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                           <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># Transform it to Stokes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_Jones</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
        <span class="c1"># Depolarize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_depolarization</span><span class="p">(</span><span class="n">degree_pol</span><span class="o">=</span><span class="n">degree_pol</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># @_actualize_</span>
<div class="viewcode-block" id="Stokes.general_charac_angles"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.general_charac_angles">[docs]</a>    <span class="k">def</span> <span class="nf">general_charac_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                              <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                              <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">amplitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">global_phase</span><span class="o">=</span><span class="n">default_phase</span><span class="p">,</span>
                              <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Stokes vectors given by their characteristic angles.</span>

<span class="sd">        References:</span>
<span class="sd">            J.J. Gil, R. Ossikovsky &quot;Polarized light and the Mueller Matrix approach&quot;, CRC Press (2016),pp 137.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            alpha (float): [0, pi]: tan(alpha) is the ratio between field amplitudes of X and Y components.</span>
<span class="sd">            delay (float): [0, 2*pi]: phase difference between X and Y field components.</span>
<span class="sd">            inetnsity if it is different than None. Default: None.</span>
<span class="sd">            amplitude (numpy.array or float): Array of electric field amplitude. Overrides inetnsity if it is different than None. Default: None.</span>
<span class="sd">            degree_pol (numpy.array or float): Array of polarization degree. Default: 1.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            global_phase (float or numpy.ndarray): Adds a global phase to the Stokes object. Default: default_phase.</span>
<span class="sd">            length (int): If final object is of size 1, it is stretched to match this size. Default: 1.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            S (4x1 numpy.matrix): Stokes vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Use amplitude if specified</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># Prepare variables</span>
        <span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">,</span>
         <span class="n">global_phase</span><span class="p">),</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">(</span>
             <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">intensity</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">,</span> <span class="n">global_phase</span><span class="p">],</span>
             <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
             <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
             <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Restrict possible values</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">put_in_limits</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">put_in_limits</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="s1">&#39;delay&#39;</span><span class="p">)</span>
        <span class="c1"># Calculate the components</span>
        <span class="n">S0</span> <span class="o">=</span> <span class="n">intensity</span>
        <span class="n">S1</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">S2</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">S3</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="c1"># Nan cases are totally depolarized</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">S3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
            <span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># From components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">),</span>
                             <span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">,</span>
                             <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
                             <span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># @_actualize_</span>
<div class="viewcode-block" id="Stokes.general_azimuth_ellipticity"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.general_azimuth_ellipticity">[docs]</a>    <span class="k">def</span> <span class="nf">general_azimuth_ellipticity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">azimuth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">ellipticity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">amplitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">degree_pol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">degree_depol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">global_phase</span><span class="o">=</span><span class="n">default_phase</span><span class="p">,</span>
                                    <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Stokes vectors given by their azimuth and ellipticity.</span>

<span class="sd">        References:</span>
<span class="sd">            J.J. Gil, R. Ossikovsky &quot;Polarized light and the Mueller Matrix approach&quot;, CRC Press (2016), pp 137.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            azimuth (float): [0, pi]: azimuth.</span>
<span class="sd">            ellipticity (float): [-pi/4, pi/4]: ellipticity.</span>
<span class="sd">            inetnsity if it is different than None. Default: None.</span>
<span class="sd">            amplitude (numpy.array or float): Array of electric field amplitude. Overrides inetnsity if it is different than None. Default: None.</span>
<span class="sd">            degree_pol (numpy.array or float): Array of polarization degree. Default: 1.</span>
<span class="sd">            degree_depol (float) [0, 1]: Depolarization degree. Overrides degree_pol if different than None. Default: None.</span>
<span class="sd">            global_phase (float or numpy.ndarray): Adds a global phase to the Stokes object. Default: default_phase.</span>
<span class="sd">            length (int): If final object is of size 1, it is stretched to match this size. Default: 1.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            S (4x1 numpy.matrix): Stokes vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Transform to polarization degree if required</span>
        <span class="k">if</span> <span class="n">degree_depol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degree_depol</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Use amplitude if specified</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># Prepare variables</span>
        <span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">ellipticity</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">,</span>
         <span class="n">global_phase</span><span class="p">),</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="n">prepare_variables</span><span class="p">(</span>
             <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">intensity</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">ellipticity</span><span class="p">,</span> <span class="n">degree_pol</span><span class="p">,</span> <span class="n">global_phase</span><span class="p">],</span>
             <span class="n">expand</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
             <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
             <span class="n">give_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Restrict possible values</span>
        <span class="n">azimuth</span> <span class="o">=</span> <span class="n">put_in_limits</span><span class="p">(</span><span class="n">azimuth</span><span class="p">,</span> <span class="s1">&#39;azimuth&#39;</span><span class="p">)</span>
        <span class="n">ellipticity</span> <span class="o">=</span> <span class="n">put_in_limits</span><span class="p">(</span><span class="n">ellipticity</span><span class="p">,</span> <span class="s1">&#39;ellipticity&#39;</span><span class="p">)</span>
        <span class="c1"># Calculate the components</span>
        <span class="n">S0</span> <span class="o">=</span> <span class="n">intensity</span>
        <span class="n">S1</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">azimuth</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ellipticity</span><span class="p">)</span>
        <span class="n">S2</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">azimuth</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ellipticity</span><span class="p">)</span>
        <span class="n">S3</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">degree_pol</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ellipticity</span><span class="p">)</span>
        <span class="c1"># Separate totally depolarization from circular polarization</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">azimuth</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ellipticity</span><span class="p">)</span>
        <span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ellipticity</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">azimuth</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ellipticity</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">tol_default</span><span class="p">))</span>
        <span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># From components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">),</span>
                             <span class="n">global_phase</span><span class="o">=</span><span class="n">global_phase</span><span class="p">,</span>
                             <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
                             <span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="n">shape_var</span><span class="o">=</span><span class="n">new_shape</span><span class="p">,</span>
                                             <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1">#######################################################################</span>
    <span class="c1"># Draw</span>
    <span class="c1">#######################################################################</span>

<div class="viewcode-block" id="Stokes.draw_poincare"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.draw_poincare">[docs]</a>    <span class="k">def</span> <span class="nf">draw_poincare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Draws stokes vector.</span>
<span class="sd">        TODO</span>

<span class="sd">            Parameters:</span>
<span class="sd">                angle_view (float, float): elevation, azimuth</span>
<span class="sd">                label (str): text for label of plot</span>
<span class="sd">                filename (str): is not empty saves figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">draw_poincare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Stokes.draw_ellipse"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Stokes.draw_ellipse">[docs]</a>    <span class="k">def</span> <span class="nf">draw_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws polarization ellipse of Jones vector.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            N_angles (int): Number of angles to plot the ellipses. Default: 91.</span>
<span class="sd">            limit (float): limit for drawing. If empty itis obtained from ampltiudes.</span>
<span class="sd">            filename (str): name of filename to save the figure.</span>
<span class="sd">            figsize (tuple): A tuple of length 2 containing the figure size. Default: (8,8).</span>
<span class="sd">            draw_arrow (bool): If True, draws an arrow containing the turning sense of the polarization. Does not work with linear polarization vectors. Default: True.</span>
<span class="sd">            depol_central (bool): If True, draws a central circle containing the unpolarized field amplitude. Default: False.</span>
<span class="sd">            depol_contour (bool): If True, draws a line enveloping the polarization ellipse in ordeer to plot the depolarization. Default: False.</span>
<span class="sd">            depol_dist (bool): If True, plots the probability distribution of the electric field. Default: False.</span>
<span class="sd">            subplots (string, tuple or None): If AS_SHAPE, divides the figure in several subplots as the shape of the py_pol object. If INDIVIDUAL, each vector is represented in its own subaxis, trying to use a square grid. If tuple, divides the figure in that same number of subplots. If None, all ellipses are plot in the same axes. Default: None.</span>
<span class="sd">            N_prob (int): Number of points in each dimension for probability distributions. Default: 256.</span>
<span class="sd">            contour_levels (tuple): Contains the contour levels (normalized to 1). Default: (0.1,).</span>
<span class="sd">            cmap (str or color object): Default colormap for probability distributions. Default: hot.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ax (handle): handle to axis.</span>
<span class="sd">            fig (handle): handle to figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">draw_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span></div></div>

        <span class="c1"># ax, fig = draw_ellipse_stokes(self, kind, limit, has_line, filename)</span>
        <span class="c1"># return ax, fig</span>

    <span class="c1"># def pseudoinverse(self, returns_matrix=True, keep=True):</span>
    <span class="c1">#     &quot;&quot;&quot;Calculates the pseudoinverse of the Stokes vector.</span>
    <span class="c1">#     TODO</span>
    <span class="c1">#</span>
    <span class="c1">#     Parameters:</span>
    <span class="c1">#         keep (bool): if True, the original element is not updated. Default: False.</span>
    <span class="c1">#         returns_matrix (bool): if True returns a matrix, else returns an instance to object. Default: True.</span>
    <span class="c1">#</span>
    <span class="c1">#     Returns:</span>
    <span class="c1">#         (numpy.matrix or Mueller object): 4x4 matrix.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1"># # Calculate pseudoinverse</span>
    <span class="c1"># S = np.matrix(self.M)</span>
    <span class="c1"># Sinv = (S.T * S).I * S.T</span>
    <span class="c1">#</span>
    <span class="c1"># # Caluclate inverse</span>
    <span class="c1"># if keep:</span>
    <span class="c1">#     S2 = Stokes(self.name + &#39;_inv&#39;)</span>
    <span class="c1">#     S2.from_matrix(Sinv)</span>
    <span class="c1"># else:</span>
    <span class="c1">#     self.from_matrix(Sinv)</span>
    <span class="c1"># if returns_matrix:</span>
    <span class="c1">#     return Sinv</span>
    <span class="c1"># else:</span>
    <span class="c1">#     if keep:</span>
    <span class="c1">#         return S2</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         return self</span>


<div class="viewcode-block" id="Parameters_Stokes_vector"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector">[docs]</a><span class="k">class</span> <span class="nc">Parameters_Stokes_vector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for Stokes vector Parameters</span>

<span class="sd">    Parameters:</span>
<span class="sd">        Stokes_vector (Stokes_vector): Stokes Vector</span>

<span class="sd">    Attributes:</span>
<span class="sd">        self.M (Stokes_vector)</span>
<span class="sd">        self.dict_params (dict): dictionary with parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stokes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">Stokes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints all the parameters.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

<div class="viewcode-block" id="Parameters_Stokes_vector.help"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: prints help about dictionary&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.get_all"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.get_all">[docs]</a>    <span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a dictionary with all the parameters of Stokes vectors.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;E0x&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;E0y&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span>
            <span class="s1">&#39;E0u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                     <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">,</span>
                                     <span class="n">give_unpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;global_phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                             <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;degree_depol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree_depolarization</span><span class="p">(</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;degree_pol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span>
            <span class="s1">&#39;degree_linear_pol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree_linear_polarization</span><span class="p">(</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span>
            <span class="s1">&#39;degree_circular_pol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree_circular_polarization</span><span class="p">(</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;delay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;ellipticity_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipticity_param</span><span class="p">(</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;ellipticity_angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipticity_angle</span><span class="p">(</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;eccentricity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                             <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;S_p&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span>
            <span class="s1">&#39;S_u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.matrix"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.matrix">[docs]</a>    <span class="k">def</span> <span class="nf">matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the numpy array of the Stokes object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray) 2xN numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shape</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">select_shape</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                                <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">M</span>
        <span class="k">return</span> <span class="n">M</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.global_phase"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.global_phase">[docs]</a>    <span class="k">def</span> <span class="nf">global_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">give_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extracts the global phase of the Stokes vector.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            give_nan(bool): If False, NaN values are transformed into 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">global_phase</span>
        <span class="c1"># If the phase is None (unknown), give nans or zeros</span>
        <span class="k">if</span> <span class="n">gp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">give_nan</span><span class="p">:</span>
                <span class="n">gp</span> <span class="o">=</span> <span class="n">gp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># If the result is a number and the user asks for it, return a float</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">gp</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">gp</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Calculate Ez and reshape if required</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">([</span><span class="n">gp</span><span class="p">],</span>
                     <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                     <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                     <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The global phase of </span><span class="si">{}</span><span class="s1"> is (deg):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">gp</span> <span class="o">/</span> <span class="n">degrees</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Global phase (deg)&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gp</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.components"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.components">[docs]</a>    <span class="k">def</span> <span class="nf">components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the $S_0$, $S_1$, $S_2$ and $S_3$ components of the Stokes vector.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            S0 (float or numpy.ndarray): Array of total intensity.</span>
<span class="sd">            S1 (float or numpy.ndarray): Array of linearly horizontal or vertical polarized intensity.</span>
<span class="sd">            S2 (float or numpy.ndarray): Array of linearly 45º or 135º polarized intensity.</span>
<span class="sd">            S3 (float or numpy.ndarray): Array of circularly polarized intensity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components</span>
        <span class="n">S0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">S1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">S2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c1"># If the result is a number and the user asks for it, return a float</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">S0</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">S0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">S3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Calculate Ez and reshape if required</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">([</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">],</span>
                                 <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                 <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                 <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The intensity components of </span><span class="si">{}</span><span class="s1"> are (a.u.):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;S0: (a.u.)&quot;</span><span class="p">,</span> <span class="s2">&quot;S1: (a.u.)&quot;</span><span class="p">,</span> <span class="s2">&quot;S2: (a.u.)&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;S3: (a.u.)&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.intensity"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.intensity">[docs]</a>    <span class="k">def</span> <span class="nf">intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the intensity of the Stokes vector ($S_0$).</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.2)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate intensity</span>
        <span class="n">S0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c1"># If the result is a number and the user asks for it, return a float</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">S0</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">S0</span> <span class="o">=</span> <span class="n">S0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Calculate Ez and reshape if required</span>
        <span class="n">S0</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">([</span><span class="n">S0</span><span class="p">],</span>
                     <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                     <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                     <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The intensity of </span><span class="si">{}</span><span class="s1"> is (a.u.):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">S0</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Intensity: (a.u.)&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">S0</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.irradiance"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.irradiance">[docs]</a>    <span class="k">def</span> <span class="nf">irradiance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the intensity of the Stokes vector ($S_0$).</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.2)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the irradiance</span>
        <span class="n">Irrad</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
            <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">,</span> <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The irradiance of </span><span class="si">{}</span><span class="s1"> is (W/m^2):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">Irrad</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Irradiance: (W/m^2)&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Irrad</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.degree_polarization"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.degree_polarization">[docs]</a>    <span class="k">def</span> <span class="nf">degree_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the degree of polarization (DP) of the Stokes vectors.</span>

<span class="sd">        $DP=\frac{\sqrt{S_{1}^{2}+S_{2}^{2}+S_{3}^{2}}}{S_{0}}$</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.3)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                         <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                         <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="c1"># Calculate the polarization degree</span>
        <span class="n">DOP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">DOP</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">S0</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">use_nan</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">cond</span><span class="p">):</span>
            <span class="n">DOP</span><span class="p">[</span><span class="o">~</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The degree of polarization of </span><span class="si">{}</span><span class="s1"> is:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">DOP</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Degree of polarization&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">DOP</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.degree_depolarization"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.degree_depolarization">[docs]</a>    <span class="k">def</span> <span class="nf">degree_depolarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the degree ofde polarization (DD) of the Stokes vectors.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components</span>
        <span class="n">DOP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">use_nan</span><span class="o">=</span><span class="n">use_nan</span><span class="p">,</span>
                                       <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                       <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                       <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="c1"># Calculate the depolarization degree</span>
        <span class="n">DD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">DOP</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The degree of depolarization of </span><span class="si">{}</span><span class="s1"> is:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">DD</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Degree of depolarization&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">DD</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.degree_linear_polarization"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.degree_linear_polarization">[docs]</a>    <span class="k">def</span> <span class="nf">degree_linear_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the degree of linear polarization (DLP) of the Stokes vectors.</span>

<span class="sd">        $DLP=\frac{\sqrt{S_{1}^{2}+S_{2}^{2}{S_{0}}$</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.4)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                        <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                        <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="c1"># Calculate the polarization degree</span>
        <span class="n">DOP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">DOP</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">S0</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">use_nan</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">cond</span><span class="p">):</span>
            <span class="n">DOP</span><span class="p">[</span><span class="o">~</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The degree of linear polarization of </span><span class="si">{}</span><span class="s1"> is:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">DOP</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Degree of linear polarization&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">DOP</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.degree_circular_polarization"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.degree_circular_polarization">[docs]</a>    <span class="k">def</span> <span class="nf">degree_circular_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                     <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                     <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the degree of circular polarization (DCP) of the Stokes vectors.</span>

<span class="sd">        $DCP=\frac{S_{3}}{S_{0}}$</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.5)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                       <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                       <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="c1"># Calculate the polarization degree</span>
        <span class="n">DOP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">DOP</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">])</span> <span class="o">/</span> <span class="n">S0</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">use_nan</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">cond</span><span class="p">):</span>
            <span class="n">DOP</span><span class="p">[</span><span class="o">~</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The degree of circular polarization of </span><span class="si">{}</span><span class="s1"> is:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">DOP</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Degree of circular polarization&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">DOP</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.alpha"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.alpha">[docs]</a>    <span class="k">def</span> <span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the ratio angle between electric field amplitudes.</span>

<span class="sd">        .. math:: arcsin(E_y/Ex).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components of the fully polarized part of S</span>
        <span class="n">Sp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Sp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                                <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                                <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Preallocate memory</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Calculate if intensity is enough</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_default</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">alpha</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">/</span> <span class="n">S0</span><span class="p">[</span><span class="n">cond</span><span class="p">])</span>
        <span class="c1"># If the result is a number and the user asks for it, return a float</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">alpha</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The alpha of </span><span class="si">{}</span><span class="s1"> is (deg):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="n">degrees</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Alpha: (deg)&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">alpha</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.delay"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Phase shift between $E_x$ and $E_y$ electric field components.</span>

<span class="sd">        .. math:: \delta_2 - \delta_1.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                        <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                        <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Preallocate memory</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Calculate if intensity is enough</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_default</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">delta</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">],</span> <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">])</span>
        <span class="c1"># Make sure the values are in the correct range</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">put_in_limits</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The delay of </span><span class="si">{}</span><span class="s1"> is (deg):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">degrees</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Delay: (deg)&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.delta"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.delta">[docs]</a>    <span class="k">def</span> <span class="nf">delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Phase shift between $E_x$ and $E_y$ electric field components. This is the same as *delay*.</span>

<span class="sd">        .. math:: \delta_2 - \delta_1.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">use_nan</span><span class="o">=</span><span class="n">use_nan</span><span class="p">,</span>
                          <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">,</span>
                          <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                          <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                          <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                          <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.charac_angles"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.charac_angles">[docs]</a>    <span class="k">def</span> <span class="nf">charac_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the characteristic angles of the Stokes object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            alpha (float): [0, pi/2]: tan(alpha) is the ratio angle between amplitudes of the electric field.</span>
<span class="sd">            delay (float): [0, 2*pi]: phase difference between both components of the electric field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">(</span><span class="n">use_nan</span><span class="o">=</span><span class="n">use_nan</span><span class="p">,</span>
                           <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">,</span>
                           <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                           <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">(</span><span class="n">use_nan</span><span class="o">=</span><span class="n">use_nan</span><span class="p">,</span>
                           <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">,</span>
                           <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                           <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">delta</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.ellipticity_param"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.ellipticity_param">[docs]</a>    <span class="k">def</span> <span class="nf">ellipticity_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the ellipticity parameter: the ratio between the minor and major polarization ellipse axes. It takes only into account the fully polarized part of the Stokes vector. It goes from 0 for linearly polarized light to 1 for circulary polarized light. Positive sign means left-handed and negative values right-handed rotation direction.</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.7)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components of the fully polarized part of S</span>
        <span class="n">Sp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">Sp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                                  <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                                  <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Preallocate memory</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="n">el</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Act if we have some polarization</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">S1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">S2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">S3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">el</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">S0</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="c1"># If the result is a number and the user asks for it, return a float</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">el</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The ellipticity parameter of </span><span class="si">{}</span><span class="s1"> is:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">el</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ellipticity parameter&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">el</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.ellipticity_angle"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.ellipticity_angle">[docs]</a>    <span class="k">def</span> <span class="nf">ellipticity_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the ratio angle between the major and minor axis length. It goes from 0 degrees for linearly polarized light to 45 degrees for circular polarized light. Positive sign means left-handed and negative values right-handed rotation direction.</span>

<span class="sd">        References:</span>
<span class="sd">            J.J. Gil, R. Ossikovsky &quot;Polarized light and the Mueller Matrix approach&quot;, CRC Press (2016) pp 13.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the ellipticity parameter</span>
        <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipticity_param</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                    <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                    <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="c1"># Transform to angle</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The ellipticity angle of </span><span class="si">{}</span><span class="s1"> is (deg):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">el</span> <span class="o">/</span> <span class="n">degrees</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ellipticity angle: (deg)&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">el</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.azimuth"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.azimuth">[docs]</a>    <span class="k">def</span> <span class="nf">azimuth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the rotation angle of the polarization elipse major axis. If S is not fully polarized, azimuth is computed on the fully polarized part of S. Azimuth ranges from 0 to 180 degres (not included this last value).</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.8)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the components of the fully polarized part of S</span>
        <span class="n">Sp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">Sp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                                  <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                                  <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Preallocate memory</span>
        <span class="n">azimuth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">azimuth</span> <span class="o">=</span> <span class="n">azimuth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Take some cases apart</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol_default</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">&gt;</span> <span class="n">tol_default</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">azimuth</span><span class="p">[</span><span class="n">cond1</span> <span class="o">*</span> <span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">tol_default</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">azimuth</span><span class="p">[</span><span class="n">cond1</span> <span class="o">*</span> <span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="c1"># General case</span>
        <span class="n">azimuth</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">],</span> <span class="n">S1</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">])</span>
        <span class="c1"># If the result is a number and the user asks for it, return a float</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">azimuth</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">azimuth</span> <span class="o">=</span> <span class="n">azimuth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Make sure the values are in the correct range</span>
        <span class="n">azimuth</span> <span class="o">=</span> <span class="n">put_in_limits</span><span class="p">(</span><span class="n">azimuth</span><span class="p">,</span> <span class="s1">&#39;azimuth&#39;</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The azimuth of </span><span class="si">{}</span><span class="s1"> is (deg):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">azimuth</span> <span class="o">/</span> <span class="n">degrees</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Azimuth: (deg)&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">azimuth</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.azimuth_ellipticity"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.azimuth_ellipticity">[docs]</a>    <span class="k">def</span> <span class="nf">azimuth_ellipticity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates both the azimuth and ellipticity of the Stokes object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            azimuth (float or numpy.ndarray): [0, pi): Azimuth.</span>
<span class="sd">            ellipticity (float or numpy.ndarray): [-pi/4, pi/4]: Ellipticity angle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">azimuth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="p">(</span><span class="n">use_nan</span><span class="o">=</span><span class="n">use_nan</span><span class="p">,</span>
                               <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">,</span>
                               <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                               <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                               <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="n">ellipticity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipticity_angle</span><span class="p">(</span><span class="n">use_nan</span><span class="o">=</span><span class="n">use_nan</span><span class="p">,</span>
                                             <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">,</span>
                                             <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                             <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                             <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                             <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">ellipticity</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.eccentricity"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.eccentricity">[docs]</a>    <span class="k">def</span> <span class="nf">eccentricity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The eccentricity of the polarization ellipse (0 for circular polarization, 1 for linear).</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.9)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to 0. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float or numpy.ndarray): Result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the ellipticity parameter</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipticity_param</span><span class="p">(</span><span class="n">use_nan</span><span class="o">=</span><span class="n">use_nan</span><span class="p">,</span>
                                   <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">,</span>
                                   <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                   <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># Now we can calculate the eccentricity</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The eccentricity of </span><span class="si">{}</span><span class="s1"> is:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">e2</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Eccentricity&quot;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">e2</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.ellipse_axes"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.ellipse_axes">[docs]</a>    <span class="k">def</span> <span class="nf">ellipse_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the length of major and minor axis (a,b) of the polarization elipse. This is a wrapper around the Parameters_Jones_Vector.ellipse_axes function.</span>

<span class="sd">        References:</span>
<span class="sd">            D. Golstein &quot;Polarized light&quot; 2nd ed Marcel Dekker (2003), 3.4 eq.3-30a and 3-30b</span>

<span class="sd">        Parameters:</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            sort (bool): If True, it sorts a and b to be the major and minor axis respectively. Default: True. TODO: Check why this is neccessary.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            a (numpy.ndarray or float): Major axis</span>
<span class="sd">            b (numpy.ndarray or float): Minor axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Go to Jones, it is much easier</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">Jones_vector</span><span class="p">()</span>
        <span class="n">J</span><span class="o">.</span><span class="n">from_Stokes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">J</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ellipse_axes</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">,</span>
                                         <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
                                         <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                         <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                         <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.polarized_unpolarized"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.polarized_unpolarized">[docs]</a>    <span class="k">def</span> <span class="nf">polarized_unpolarized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divides the Stokes vector in two, one totally polarized and the other totally unpolarized.</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.16 (eq.6)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sp (Stokes): Totally polarized Stokes object.</span>
<span class="sd">            Su (Stokes): Totally unpolarized Stokes object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the degree of polarization and the components</span>
        <span class="n">DOP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">)</span>
        <span class="c1"># Create the Stokes objects</span>
        <span class="n">Sp</span><span class="p">,</span> <span class="n">Su</span> <span class="o">=</span> <span class="n">create_Stokes</span><span class="p">((</span><span class="s1">&#39;Polarized &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="s1">&#39;Unpolarized &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">Sp</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span>
            <span class="p">(</span><span class="n">DOP</span> <span class="o">*</span> <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">),</span>
            <span class="n">global_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">))</span>
        <span class="n">Su</span><span class="o">.</span><span class="n">from_components</span><span class="p">(((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">DOP</span><span class="p">)</span> <span class="o">*</span> <span class="n">S0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Sp</span><span class="p">,</span> <span class="n">Su</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Sp</span><span class="p">,</span> <span class="n">Su</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.amplitudes"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.amplitudes">[docs]</a>    <span class="k">def</span> <span class="nf">amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">give_Ez</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">give_unpol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the $E_x$ and $E_y$ field amplitudes of the polarized part of the Stokes vectos. It may also calculate $E_z$ and the field amplitude of the unpolarized part.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            give_Ez (bool): If True, it returns the z component of the electric field (all values will be 0). Default: False.</span>
<span class="sd">            give_unpol (bool): If True, it returns the unpolarized component of the electric field. Default: False.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            E0x (numpy.ndarray or float): Array of electric field amplitude along x axis.</span>
<span class="sd">            E0y (numpy.ndarray or float): Array of electric field amplitude along y axis.</span>
<span class="sd">            E0z (numpy.array, optional): Array of electric field amplitude along z axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Separate the polarized and the unpolarized parts</span>
        <span class="n">Sp</span><span class="p">,</span> <span class="n">Su</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">()</span>
        <span class="c1"># Extract the important parameters</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Sp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                                <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                                <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="c1"># Calculate the amplitudes</span>
        <span class="n">E0x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">S0</span> <span class="o">+</span> <span class="n">S1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">E0y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">S0</span> <span class="o">-</span> <span class="n">S1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">give_Ez</span><span class="p">:</span>
            <span class="n">E0z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeroslike</span><span class="p">(</span><span class="n">E0x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">give_unpol</span><span class="p">:</span>
            <span class="n">Iu</span> <span class="o">=</span> <span class="n">Su</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">intensity</span><span class="p">(</span><span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                         <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                         <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
            <span class="n">E0u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Iu</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The elctric field amplitudes of </span><span class="si">{}</span><span class="s1"> are (V/m):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">give_Ez</span> <span class="ow">and</span> <span class="n">give_unpol</span><span class="p">:</span>
                <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span><span class="p">,</span> <span class="n">E0z</span><span class="p">,</span> <span class="n">E0u</span><span class="p">),</span>
                           <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Ex (V/m)&#39;</span><span class="p">,</span> <span class="s1">&#39;Ey (V/m)&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez (V/m)&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;Eu (V/m)&#39;</span><span class="p">),</span>
                           <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">give_Ez</span><span class="p">:</span>
                <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span><span class="p">,</span> <span class="n">E0z</span><span class="p">),</span>
                           <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Ex (V/m)&#39;</span><span class="p">,</span> <span class="s1">&#39;Ey (V/m)&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez (V/m)&#39;</span><span class="p">),</span>
                           <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">give_unpol</span><span class="p">:</span>
                <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span><span class="p">,</span> <span class="n">E0u</span><span class="p">),</span>
                           <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Ex (V/m)&#39;</span><span class="p">,</span> <span class="s1">&#39;Ey (V/m)&#39;</span><span class="p">,</span> <span class="s1">&#39;Eu (V/m)&#39;</span><span class="p">),</span>
                           <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span><span class="p">),</span>
                           <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Ex (V/m)&#39;</span><span class="p">,</span> <span class="s1">&#39;Ey (V/m)&#39;</span><span class="p">),</span>
                           <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">if</span> <span class="n">give_Ez</span> <span class="ow">and</span> <span class="n">give_unpol</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span><span class="p">,</span> <span class="n">E0z</span><span class="p">,</span> <span class="n">E0u</span>
        <span class="k">elif</span> <span class="n">give_Ez</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span><span class="p">,</span> <span class="n">E0z</span>
        <span class="k">elif</span> <span class="n">give_unpol</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span><span class="p">,</span> <span class="n">E0u</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span></div>

<div class="viewcode-block" id="Parameters_Stokes_vector.norm"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Parameters_Stokes_vector.norm">[docs]</a>    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the algebraic norm of the Stokes vectors.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (float or numpy.ndarray): Use the shape of this array. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            S0 (float or numpy.ndarray): Array of total intensity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the norm</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Reshape if neccessary</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">([</span><span class="n">norm</span><span class="p">],</span>
                       <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                       <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;The norm of </span><span class="si">{}</span><span class="s1"> is (a.u.):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Vector norm (a.u.)&#39;</span><span class="p">,</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">norm</span></div></div>


<div class="viewcode-block" id="Analysis_Stokes"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Analysis_Stokes">[docs]</a><span class="k">class</span> <span class="nc">Analysis_Stokes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for Analysis of Stokes vetors.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        stokes_vector (Stokes): Stokes vector</span>

<span class="sd">    Attributes:</span>
<span class="sd">        self.parent (Stokes)</span>
<span class="sd">        self.M (stokes_vector)</span>
<span class="sd">        self.dict_params (dict): dictionary with parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Analysis_Stokes.help"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Analysis_Stokes.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;prints help about dictionary&quot;&quot;&quot;</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Here we explain the meaning of parameters.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;    intensity: intensity of the light beam.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;    TODO&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="Analysis_Stokes.filter_physical_conditions"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Analysis_Stokes.filter_physical_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">filter_physical_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that filters experimental errors by forcing the Stokes vector to fulfill the conditions necessary for a vector to be real light.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance in equalities.</span>
<span class="sd">            keep (bool): If true, the object is updated to the filtered result. If false, a new fresh copy is created. Default: True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            S (Stokes): Filtered Stokes vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Act differently if we want to keep self intact</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="c1"># Check if the Stokes vector is physically realizable</span>
        <span class="n">cond</span><span class="p">,</span> <span class="n">dict_param</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">is_physical</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                      <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                                                      <span class="n">give_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Act only if it isn&#39;t</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
            <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Fix the first and second conditions</span>
            <span class="n">S0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span>
            <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">S1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">S2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">S3</span><span class="p">))</span>
            <span class="c1"># Fix the third condition</span>
            <span class="n">PD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">S2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">S3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">S0</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">PD</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">tol</span>
            <span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">S1</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">/</span> <span class="n">PD</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
            <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">S2</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">/</span> <span class="n">PD</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
            <span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="n">S3</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">/</span> <span class="n">PD</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
            <span class="c1"># Reconstruct the object</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">from_components</span><span class="p">((</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_obj</span></div></div>


<div class="viewcode-block" id="Check_Stokes"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes">[docs]</a><span class="k">class</span> <span class="nc">Check_Stokes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for Check of Stokes vectors.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        stokes_vector (Stokes): Stokes vector</span>

<span class="sd">    Attributes:</span>
<span class="sd">        self.parent (Stokes)</span>
<span class="sd">        self.M (stokes_vector)</span>
<span class="sd">        self.dict_params (dict): dictionary with parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints all the checks&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

<div class="viewcode-block" id="Check_Stokes.get_all"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.get_all">[docs]</a>    <span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a dictionary with all the checks of Stokes vectors.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;is_physical&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span>
            <span class="s1">&#39;dict_is_physical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_physical</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                   <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">,</span>
                                                   <span class="n">give_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;is_linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_linear</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;is_circular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_circular</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;is_right_handed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_right_handed</span><span class="p">(</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;is_left_handed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_left_handed</span><span class="p">(</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;is_polarized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_polarized</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                             <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;is_totally_polarized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_totally_polarized</span><span class="p">(</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span><span class="s1">&#39;is_depolarized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_depolarized</span><span class="p">(</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span><span class="p">[</span>
            <span class="s1">&#39;is_totally_depolarized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_totally_depolarized</span><span class="p">(</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_params</span></div>

<div class="viewcode-block" id="Check_Stokes.help"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints help about dictionary.</span>

<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Check_Stokes.is_physical"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_physical">[docs]</a>    <span class="k">def</span> <span class="nf">is_physical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                    <span class="n">give_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tests the conditions of physical realizability:</span>

<span class="sd">        * Condition 1: All components must be real.</span>
<span class="sd">        * Condition 2: S0 must be positive.</span>
<span class="sd">        * Condition 3: The square sum of S1, S2 and S3 must be equal or lower than S0.</span>

<span class="sd">        References:</span>
<span class="sd">            Handbook of Optics vol 2. 22.34</span>
<span class="sd">            &quot;Polarized light and the Mueller Matrix approach&quot;, J. J. Gil, pp 187.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance in equality conditions</span>
<span class="sd">            give_all (bool): If True, the function will return the individual conditions.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            cond (bool): Is real or not.</span>
<span class="sd">            ind (dictionary, optional): dictionary with condition, True/False, distance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the three Conditions</span>
        <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cond1_0</span><span class="p">,</span> <span class="n">cond1_1</span><span class="p">,</span> <span class="n">cond1_2</span><span class="p">,</span> <span class="n">cond1_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="n">S0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="n">S1</span><span class="p">),</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="n">S2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="n">S3</span><span class="p">))</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">tol</span>
        <span class="n">DOP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cond3</span> <span class="o">=</span> <span class="n">DOP</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">tol</span>
        <span class="c1"># Calculate Ez and reshape if required</span>
        <span class="n">cond1_0</span><span class="p">,</span> <span class="n">cond1_1</span><span class="p">,</span> <span class="n">cond1_2</span><span class="p">,</span> <span class="n">cond1_3</span><span class="p">,</span> <span class="n">cond2</span><span class="p">,</span> <span class="n">cond3</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span>
            <span class="p">[</span><span class="n">cond1_0</span><span class="p">,</span> <span class="n">cond1_1</span><span class="p">,</span> <span class="n">cond1_2</span><span class="p">,</span> <span class="n">cond1_3</span><span class="p">,</span> <span class="n">cond2</span><span class="p">,</span> <span class="n">cond3</span><span class="p">],</span>
            <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
            <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
            <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Calculate final conditions</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="n">cond1_0</span> <span class="o">*</span> <span class="n">cond1_1</span> <span class="o">*</span> <span class="n">cond1_2</span> <span class="o">*</span> <span class="n">cond1_3</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">cond1</span> <span class="o">*</span> <span class="n">cond2</span> <span class="o">*</span> <span class="n">cond3</span>
        <span class="c1"># Create the dictionary with all the conditions if desired</span>
        <span class="k">if</span> <span class="n">give_all</span><span class="p">:</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;cond1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cond1</span>
            <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;cond1_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cond1_0</span>
            <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;cond1_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cond1_1</span>
            <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;cond1_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cond1_2</span>
            <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;cond1_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cond1_3</span>
            <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;cond2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cond2</span>
            <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;S0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S0</span>
            <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;cond3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cond3</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">give_all</span><span class="p">:</span>
                <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is physically realizable:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond1_0</span><span class="p">,</span> <span class="n">cond1_1</span><span class="p">,</span> <span class="n">cond1_2</span><span class="p">,</span> <span class="n">cond1_3</span><span class="p">,</span> <span class="n">cond1</span><span class="p">,</span>
                                  <span class="n">cond2</span><span class="p">,</span> <span class="n">cond3</span><span class="p">,</span> <span class="n">cond</span><span class="p">),</span>
                           <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Physicall (cond. 1, S0)&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Physicall (cond. 1, S1)&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Physicall (cond. 1, S2)&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Physicall (cond. 1, S3)&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Physicall (cond. 1)&quot;</span><span class="p">,</span> <span class="s2">&quot;Physicall (cond. 2)&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Physicall (cond. 3)&quot;</span><span class="p">,</span> <span class="s2">&quot;Physicall&quot;</span><span class="p">),</span>
                           <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is physically realizable:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                           <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Physicall&quot;</span><span class="p">),</span>
                           <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                           <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">if</span> <span class="n">give_all</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cond</span><span class="p">,</span> <span class="nb">dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cond</span></div>

<div class="viewcode-block" id="Check_Stokes.is_linear"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_linear">[docs]</a>    <span class="k">def</span> <span class="nf">is_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                  <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates if the Stokes vectors are linearly polarized.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance.</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to False. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or bool): Array of the condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Preallocate memory</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># No bool to allow nans</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="c1"># If the Stokes vector is totally depolarized, polarization is not defined</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_totally_depolarized</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">cond</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Calculate the relative degree of linear polarization</span>
        <span class="n">DP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">DLP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_linear_polarization</span><span class="p">(</span>
            <span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cond</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">DLP</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">]</span> <span class="o">/</span> <span class="n">DP</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tol</span>
        <span class="c1"># Give a number if required</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">cond</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Reshape if required</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">([</span><span class="n">cond</span><span class="p">],</span>
                       <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                       <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is linearly polarized:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Linearly polarized&#39;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">cond</span></div>

<div class="viewcode-block" id="Check_Stokes.is_circular"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_circular">[docs]</a>    <span class="k">def</span> <span class="nf">is_circular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                    <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates if the Stokes vectors are circularly polarized.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance.</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to False. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or bool): Array of the condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Preallocate memory</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># No bool to allow nans</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="c1"># If the Stokes vector is totally depolarized, polarization is not defined</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_totally_depolarized</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">cond</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Calculate the relative degree of linear polarization</span>
        <span class="n">DP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                        <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">DCP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_circular_polarization</span><span class="p">(</span>
            <span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cond</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">DCP</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">]</span> <span class="o">/</span> <span class="n">DP</span><span class="p">[</span><span class="o">~</span><span class="n">cond1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tol</span>
        <span class="c1"># Give a number if required</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">cond</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Reshape if required</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">([</span><span class="n">cond</span><span class="p">],</span>
                       <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                       <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is circcularly polarized:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Circularly polarized&#39;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">cond</span></div>

<div class="viewcode-block" id="Check_Stokes.is_right_handed"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_right_handed">[docs]</a>    <span class="k">def</span> <span class="nf">is_right_handed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                        <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates if the polarization rotation direction is right-handed.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance.</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to False. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or bool): Array of the condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Preallocate memory</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># No bool to allow nans</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="c1"># If the Stokes vector is linearly polarized or totally depolarized, right and left handed is not defined</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_linear</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">*</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">is_totally_depolarized</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">cond</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># If delay is between 0 and pi (not included), it is right handed</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                             <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                             <span class="n">use_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="o">~</span><span class="n">cond1</span> <span class="o">*</span> <span class="p">(</span><span class="n">delay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">delay</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">cond</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Give a number if required</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">cond</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Reshape if required</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">([</span><span class="n">cond</span><span class="p">],</span>
                       <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                       <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is right handed:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Right handed&#39;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">cond</span></div>

<div class="viewcode-block" id="Check_Stokes.is_left_handed"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_left_handed">[docs]</a>    <span class="k">def</span> <span class="nf">is_left_handed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                       <span class="n">use_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates if the polarization rotation direction is left-handed.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance.</span>
<span class="sd">            use_nan (bool): If True, unknown values are set to np.nan, otherwise they are set to False. Default: True.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or bool): Array of the condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Preallocate memory</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># No bool to allow nans</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="c1"># If the Stokes vector is linearly polarized or totally depolarized, right and left handed is not defined</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_linear</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">*</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">is_totally_depolarized</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_nan</span><span class="p">:</span>
            <span class="n">cond</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># If delay is between 0 and pi (not included), it is right handed</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="o">~</span><span class="n">cond1</span> <span class="o">*</span> <span class="p">(</span><span class="n">delay</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">delay</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">cond</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Give a number if required</span>
        <span class="k">if</span> <span class="n">out_number</span> <span class="ow">and</span> <span class="n">cond</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Reshape if required</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">([</span><span class="n">cond</span><span class="p">],</span>
                       <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                       <span class="n">shape_fun</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is left handed:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Left handed&#39;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">cond</span></div>

<div class="viewcode-block" id="Check_Stokes.is_polarized"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_polarized">[docs]</a>    <span class="k">def</span> <span class="nf">is_polarized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                     <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates if the Stokes vectors are at least partially polarized.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or bool): Array of the condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the polarization degree</span>
        <span class="n">PD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                                        <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                                        <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">PD</span> <span class="o">&gt;</span> <span class="n">tol</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is polarized:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Polarized&#39;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">cond</span></div>

<div class="viewcode-block" id="Check_Stokes.is_totally_polarized"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_totally_polarized">[docs]</a>    <span class="k">def</span> <span class="nf">is_totally_polarized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                             <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates if the Stokes vectors are totally polarized.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or bool): Array of the condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the polarization degree</span>
        <span class="n">PD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                                        <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span>
                                                        <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">PD</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tol</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is totally polarized:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Totally polarized&#39;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">cond</span></div>

<div class="viewcode-block" id="Check_Stokes.is_depolarized"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_depolarized">[docs]</a>    <span class="k">def</span> <span class="nf">is_depolarized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                       <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates if the Stokes vectors are at least partially depolarized.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or bool): Array of the condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the polarization degree</span>
        <span class="n">DD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_depolarization</span><span class="p">(</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">DD</span> <span class="o">&gt;</span> <span class="n">tol</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is depolarized:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Depolarized&#39;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">cond</span></div>

<div class="viewcode-block" id="Check_Stokes.is_totally_depolarized"><a class="viewcode-back" href="../../py_pol.html#py_pol.stokes.Check_Stokes.is_totally_depolarized">[docs]</a>    <span class="k">def</span> <span class="nf">is_totally_depolarized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">tol</span><span class="o">=</span><span class="n">tol_default</span><span class="p">,</span>
                               <span class="n">out_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">shape_like</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates if the Stokes vectors are totally depolarized.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tol (float): Tolerance.</span>
<span class="sd">            out_number (bool): if True and the result is a 1x1 array, return a number instead. Default: True.</span>
<span class="sd">            shape_like (numpy.ndarray or py_pol object): Use the shape of this object. Default: None.</span>
<span class="sd">            shape (tuple or list): If no shape_like array is given, use this shape instead. Default: None.</span>
<span class="sd">            verbose (bool): if True prints the parameter. Default: False.</span>
<span class="sd">            draw (bool): If True and the object is a 1D or 2D, plot it. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray or bool): Array of the condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate the polarization degree</span>
        <span class="n">DD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_depolarization</span><span class="p">(</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape_like</span><span class="o">=</span><span class="n">shape_like</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="n">out_number</span><span class="p">)</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">DD</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tol</span>
        <span class="c1"># Print the result if required</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">draw</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is totally depolarized:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">PrintParam</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span>
                       <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Totally depolarized&#39;</span><span class="p">),</span>
                       <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                       <span class="n">draw</span><span class="o">=</span><span class="n">draw</span><span class="p">)</span>
        <span class="c1"># Return</span>
        <span class="k">return</span> <span class="n">cond</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Luis Miguel Sanchez Brea / Jesus del Hoyo

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>