

<!DOCTYPE html>
<html class="writer-html4" lang="English" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>py_pol.drawings &mdash; Python polarization 1.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Python polarization
          

          
          </a>

          
            
            
              <div class="version">
                1.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">1. Python polarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">3. Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">4. py_pol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">5. Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">6. Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">7. History</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python polarization</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>py_pol.drawings</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for py_pol.drawings</h1><div class="highlight"><pre>
<span></span><span class="c1"># !/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># ------------------------------------</span>
<span class="c1"># Authors:    Luis Miguel Sanchez Brea and Jesus del Hoyo</span>
<span class="c1"># Date:       2019/02/03 (version 1.0)</span>
<span class="c1"># License:    GPL</span>
<span class="c1"># ------------------------------------</span>
<span class="sd">&quot;&quot;&quot; functions for drawing &quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">asarray</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">meshgrid</span><span class="p">,</span>
                   <span class="n">ndarray</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="n">outer</span><span class="p">,</span> <span class="n">real</span><span class="p">,</span> <span class="n">remainder</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span>
                   <span class="n">zeros_like</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">fftconvolve</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">np</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">eps</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">nearest2</span>

<span class="c1"># print(matplotlib.__version__)</span>

<span class="n">Axes3D</span> <span class="o">=</span> <span class="n">Axes3D</span>  <span class="c1"># pycharm auto import</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">TABLEAU_COLORS</span>
<span class="n">name_colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
<span class="n">linestyles</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">),</span>
              <span class="p">(</span><span class="s1">&#39;loosely dashdotted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))),</span>
              <span class="p">(</span><span class="s1">&#39;dashdotted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span>
              <span class="p">(</span><span class="s1">&#39;densely dashdotted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))),</span>
              <span class="p">(</span><span class="s1">&#39;dashdotdotted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))),</span>
              <span class="p">(</span><span class="s1">&#39;loosely dashdotdotted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))),</span>
              <span class="p">(</span><span class="s1">&#39;densely dashdotdotted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))]</span>

<span class="c1"># def draw2D(image, x, y, color=&quot;hot&quot;):  # YlGnBu  RdBu, jet, hot</span>
<span class="c1">#     &quot;&quot;&quot;Draws a 2D image.</span>
<span class="c1">#</span>
<span class="c1">#     Parameters:</span>
<span class="c1">#         x (numpy.array): x</span>
<span class="c1">#         y (numpy.array): y</span>
<span class="c1">#         xlabel (str): string for x label</span>
<span class="c1">#         ylabel (str): string for y label</span>
<span class="c1">#         title (str): title</span>
<span class="c1">#         color (str): color</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#     id_fig = plt.figure()</span>
<span class="c1">#     IDax = id_fig.add_subplot(111)</span>
<span class="c1">#</span>
<span class="c1">#     IDimage = plt.imshow(image,</span>
<span class="c1">#                          interpolation=&#39;bilinear&#39;,</span>
<span class="c1">#                          aspect=&#39;auto&#39;,</span>
<span class="c1">#                          origin=&#39;lower&#39;,</span>
<span class="c1">#                          extent=[x.min(), x.max(),</span>
<span class="c1">#                                  y.min(), y.max()])</span>
<span class="c1">#</span>
<span class="c1">#     plt.colorbar()</span>
<span class="c1">#     IDimage.set_cmap(color)</span>
<span class="c1">#     return id_fig, IDax, IDimage</span>


<div class="viewcode-block" id="draw_empty_sphere"><a class="viewcode-back" href="../../py_pol.html#py_pol.drawings.draw_empty_sphere">[docs]</a><span class="k">def</span> <span class="nf">draw_empty_sphere</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">angle_view</span><span class="p">,</span> <span class="n">axis_equal</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fucntion that plots an empty Poincare sphere.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">elev</span><span class="p">,</span> <span class="n">azim</span> <span class="o">=</span> <span class="n">angle_view</span>
    <span class="n">max_size</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span> <span class="o">*</span> <span class="n">degrees</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">degrees</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">z</span><span class="p">,</span>
                    <span class="n">rstride</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">cstride</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=.</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;k-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;k-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">ys</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">zs</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">ys</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">zs</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">ys</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">zs</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">ys</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">zs</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">ys</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">zs</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">ys</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">zs</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="mf">1.15</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">elev</span> <span class="o">/</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">azim</span> <span class="o">/</span> <span class="n">degrees</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$S_1$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$S_2$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$S_3$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zticklabels</span><span class="p">([])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">max_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">max_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="n">max_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># set_aspect_equal_3d(ax)</span>
    <span class="k">if</span> <span class="n">axis_equal</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_poincare"><a class="viewcode-back" href="../../py_pol.html#py_pol.drawings.draw_poincare">[docs]</a><span class="k">def</span> <span class="nf">draw_poincare</span><span class="p">(</span><span class="n">S</span><span class="p">,</span>
                  <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">remove_depol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
                  <span class="n">color_scatter</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                  <span class="n">color_line</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                  <span class="n">angle_view</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                  <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="n">subplots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">axis_equal</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to draw the poincare sphere.</span>
<span class="sd">    It admits Stokes or a list with Stokes, or None</span>

<span class="sd">    Parameters:</span>
<span class="sd">        stokes_points (Stokes, list, None): list of Stokes points.</span>
<span class="sd">        angle_view (float, float): Elevation and azimuth for viewing.</span>
<span class="sd">        is_normalized (bool): normalize intensity to 1.</span>
<span class="sd">        kind (str): &#39;line&#39; or &#39;scatter&#39;.</span>
<span class="sd">        color (str): color of line or scatter.</span>
<span class="sd">        label (str): labels for drawing.</span>
<span class="sd">        filename (str): name of filename to save the figure.</span>
<span class="sd">        axis_equal (bool): If True, the axis_equal method is used. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate the number of subplots</span>
    <span class="k">if</span> <span class="n">subplots</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nsubplots</span><span class="p">,</span> <span class="n">Ncurves</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">subplots</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="n">Nsubplots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subplots</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">size</span> <span class="o">%</span> <span class="n">Nsubplots</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Shape </span><span class="si">{}</span><span class="s1"> is not valid for the object </span><span class="si">{}</span><span class="s1"> of </span><span class="si">{}</span><span class="s1"> elements&#39;</span><span class="o">.</span>
                <span class="nb">format</span><span class="p">(</span><span class="n">subplots</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Ncurves</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">Nsubplots</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">subplots</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;INDIVIDUAL&#39;</span><span class="p">:</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">Ny</span><span class="p">))</span>
        <span class="n">Nsubplots</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">size</span>
        <span class="n">Ncurves</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">subplots</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;AS_SHAPE&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">Nsubplots</span><span class="p">,</span> <span class="n">Ncurves</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">Nsubplots</span> <span class="o">=</span> <span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span>
        <span class="n">Ncurves</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">Nsubplots</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid subplots option.&#39;</span><span class="p">)</span>

    <span class="c1"># Flatten the object</span>
    <span class="n">Sf</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">Sf</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Sf</span><span class="o">.</span><span class="n">size</span><span class="p">])</span>

    <span class="c1"># Calculate color min and max values</span>
    <span class="k">if</span> <span class="n">color_line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;INTENSITY&#39;</span> <span class="ow">or</span> <span class="n">color_scatter</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="s1">&#39;INTENSITY&#39;</span><span class="p">:</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">Sf</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">intensity</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">I</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">I_min</span><span class="p">,</span> <span class="n">I_max</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color_line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;DEGREE&#39;</span> <span class="ow">or</span> <span class="n">color_scatter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="s1">&#39;DEGREE&#39;</span><span class="p">:</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">Sf</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_polarization</span><span class="p">(</span><span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">D_min</span><span class="p">,</span> <span class="n">D_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">pol</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">pol</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">D_min</span><span class="p">,</span> <span class="n">D_max</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Create the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Loop to generate the poincare spheres</span>
    <span class="k">for</span> <span class="n">indS</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nsubplots</span><span class="p">):</span>
        <span class="c1"># Divide in subplots</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span>
                               <span class="n">Ny</span><span class="p">,</span>
                               <span class="n">indS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                               <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span>
                               <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">+=</span> <span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="c1"># Create the Poincare sphere</span>
        <span class="n">draw_empty_sphere</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle_view</span><span class="o">=</span><span class="n">angle_view</span><span class="p">)</span>

        <span class="c1"># Add points from Stokes</span>
        <span class="n">im_scatter</span> <span class="o">=</span> <span class="n">draw_stokes_points</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span>
                                        <span class="n">Sf</span><span class="p">[</span><span class="n">indS</span> <span class="o">*</span> <span class="n">Ncurves</span><span class="p">:(</span><span class="n">indS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                                           <span class="n">Ncurves</span><span class="p">],</span>
                                        <span class="n">I_min</span><span class="o">=</span><span class="n">I_min</span><span class="p">,</span>
                                        <span class="n">I_max</span><span class="o">=</span><span class="n">I_max</span><span class="p">,</span>
                                        <span class="n">D_min</span><span class="o">=</span><span class="n">D_min</span><span class="p">,</span>
                                        <span class="n">D_max</span><span class="o">=</span><span class="n">D_max</span><span class="p">,</span>
                                        <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span>
                                        <span class="n">remove_depol</span><span class="o">=</span><span class="n">remove_depol</span><span class="p">,</span>
                                        <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                                        <span class="n">color_scatter</span><span class="o">=</span><span class="n">color_scatter</span><span class="p">,</span>
                                        <span class="n">color_line</span><span class="o">=</span><span class="n">color_line</span><span class="p">)</span>
        <span class="c1"># Add titles</span>
        <span class="k">if</span> <span class="n">Nsubplots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subplots</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="s1">&#39;Individual&#39;</span><span class="p">,</span> <span class="s1">&#39;INDIVIDUAL&#39;</span><span class="p">):</span>
                <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">indS</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">indS</span><span class="p">,</span> <span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">))))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>

    <span class="c1"># Add supertitle if required</span>
    <span class="k">if</span> <span class="n">Nsubplots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>

    <span class="c1"># Add colormap if required</span>
    <span class="k">if</span> <span class="n">im_scatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_scatter</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">color_scatter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;INTENSITY&#39;</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Intensity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pol. degree&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="draw_stokes_points"><a class="viewcode-back" href="../../py_pol.html#py_pol.drawings.draw_stokes_points">[docs]</a><span class="k">def</span> <span class="nf">draw_stokes_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span>
                       <span class="n">S</span><span class="p">,</span>
                       <span class="n">I_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">I_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">D_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">D_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">remove_depol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span>
                       <span class="n">color_scatter</span><span class="o">=</span><span class="s1">&#39;Intensity&#39;</span><span class="p">,</span>
                       <span class="n">color_line</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to draw Stokes vectors on the poincare sphere.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        S (Stokes): Stokes object.</span>
<span class="sd">        normalize (bool): If True, normalize the Stokes vectors to have intensity 1. Default: True.</span>
<span class="sd">        I_min (float): Minimum intensity among all subplots.</span>
<span class="sd">        I_max (float): Amximum intensity among all subplots.</span>
<span class="sd">        D_min (float): Minimum polarization degree among all subplots.</span>
<span class="sd">        D_max (float): Amximum polarization degree among all subplots.</span>
<span class="sd">        remove_depol (bool): If True, plot the polarized part of the Stokes vector. Default: False.</span>
<span class="sd">        kind (str): Plot type: LINE, SCATTER or BOTH. Default: SCATTER.</span>
<span class="sd">        color_scatter (str): There are three options. INTENSITY sets the color of the points intensity dependent. DEGREE sets the color to match the polarization degree. Another posibility is to use valid color strings such as &#39;r&#39;. Default: INTENSITY.</span>
<span class="sd">        color_line (str): Only valid color strings such as &#39;r&#39;. Default: &#39;r&#39;.</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Avoid empty objects</span>
    <span class="k">if</span> <span class="n">S</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">S</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># if there is just one item in the Stokes object, change to scatter</span>
    <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;scatter&#39;</span>

    <span class="c1"># Remove deopolarization if required</span>
    <span class="k">if</span> <span class="n">remove_depol</span><span class="p">:</span>
        <span class="n">Sp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">polarized_unpolarized</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Sp</span> <span class="o">=</span> <span class="n">S</span>

    <span class="c1"># Normalize to intensity=1 if required</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">Sp</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">intensity</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">Sn</span> <span class="o">=</span> <span class="n">Sp</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Sn</span> <span class="o">=</span> <span class="n">Sp</span>

    <span class="c1"># Calculate all the required parameters</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span> <span class="o">=</span> <span class="n">Sn</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">im_scatter</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">color_scatter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;DEGREE&#39;</span><span class="p">:</span>
        <span class="n">depol</span> <span class="o">=</span> <span class="n">Sn</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">degree_depolarization</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                    <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Make the plots</span>
    <span class="k">if</span> <span class="n">kind</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;SCATTER&#39;</span><span class="p">,</span> <span class="s1">&#39;BOTH&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">color_scatter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;INTENSITY&#39;</span><span class="p">:</span>
            <span class="n">im_scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span>
                                    <span class="n">S2</span><span class="p">,</span>
                                    <span class="n">S3</span><span class="p">,</span>
                                    <span class="n">c</span><span class="o">=</span><span class="n">I</span><span class="p">,</span>
                                    <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                                    <span class="n">vmin</span><span class="o">=</span><span class="n">I_min</span><span class="p">,</span>
                                    <span class="n">vmax</span><span class="o">=</span><span class="n">I_max</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color_scatter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;DEGREE&#39;</span><span class="p">:</span>
            <span class="n">im_scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span>
                                    <span class="n">S2</span><span class="p">,</span>
                                    <span class="n">S3</span><span class="p">,</span>
                                    <span class="n">c</span><span class="o">=</span><span class="n">depol</span><span class="p">,</span>
                                    <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                                    <span class="n">vmin</span><span class="o">=</span><span class="n">D_min</span><span class="p">,</span>
                                    <span class="n">vmax</span><span class="o">=</span><span class="n">D_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color_scatter</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kind</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;LINE&#39;</span><span class="p">,</span> <span class="s1">&#39;BOTH&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Sn</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">S3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color_line</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">im_scatter</span></div>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># # Plot the points</span>
    <span class="c1"># if stokes_points is not None:</span>
    <span class="c1">#     if isinstance(stokes_points, list):</span>
    <span class="c1">#         if isinstance(stokes_points[0], matrix):</span>
    <span class="c1">#             stokes_points = asarray(stokes_points)</span>
    <span class="c1">#             s0 = stokes_points[:, 0].squeeze()</span>
    <span class="c1">#             s1 = stokes_points[:, 1].squeeze()</span>
    <span class="c1">#             s2 = stokes_points[:, 2].squeeze()</span>
    <span class="c1">#             s3 = stokes_points[:, 3].squeeze()</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             points = []</span>
    <span class="c1">#</span>
    <span class="c1">#             for i, point in enumerate(stokes_points):</span>
    <span class="c1">#                 points.append(point.M)</span>
    <span class="c1">#</span>
    <span class="c1">#             stokes_points = asarray(points)</span>
    <span class="c1">#             s0 = array(stokes_points[:, 0]).squeeze()</span>
    <span class="c1">#             s1 = array(stokes_points[:, 1]).squeeze()</span>
    <span class="c1">#             s2 = array(stokes_points[:, 2]).squeeze()</span>
    <span class="c1">#             s3 = array(stokes_points[:, 3]).squeeze()</span>
    <span class="c1">#     elif isinstance(stokes_points, ndarray):</span>
    <span class="c1">#         s0 = array(stokes_points[:, 0]).squeeze()</span>
    <span class="c1">#         s1 = array(stokes_points[:, 1]).squeeze()</span>
    <span class="c1">#         s2 = array(stokes_points[:, 2]).squeeze()</span>
    <span class="c1">#         s3 = array(stokes_points[:, 3]).squeeze()</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         s0 = array(stokes_points.M[0]).squeeze()</span>
    <span class="c1">#         s1 = array(stokes_points.M[1]).squeeze()</span>
    <span class="c1">#         s2 = array(stokes_points.M[2]).squeeze()</span>
    <span class="c1">#         s3 = array(stokes_points.M[3]).squeeze()</span>
    <span class="c1">#</span>
    <span class="c1">#     if is_normalized is True:</span>
    <span class="c1">#         s1 = s1 / s0</span>
    <span class="c1">#         s2 = s2 / s0</span>
    <span class="c1">#         s3 = s3 / s0</span>
    <span class="c1">#         max_size = 1</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         max_size = s0.max()</span>
    <span class="c1">#</span>
    <span class="c1"># if kind == &#39;line&#39;:</span>
    <span class="c1">#     ax.plot(s1, s2, s3, c=color, lw=2, label=label)</span>
    <span class="c1"># elif kind == &#39;scatter&#39;:</span>
    <span class="c1">#     ax.scatter(s1, s2, s3, c=color, s=60, label=label)</span>
    <span class="c1">#</span>
    <span class="c1"># plt.tight_layout()</span>
    <span class="c1"># if filename not in (None, [], &#39;&#39;):</span>
    <span class="c1">#     plt.savefig(filename)</span>


<div class="viewcode-block" id="draw_ellipse"><a class="viewcode-back" href="../../py_pol.html#py_pol.drawings.draw_ellipse">[docs]</a><span class="k">def</span> <span class="nf">draw_ellipse</span><span class="p">(</span><span class="n">E</span><span class="p">,</span>
                 <span class="n">N_angles</span><span class="o">=</span><span class="mi">91</span><span class="p">,</span>
                 <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                 <span class="n">limit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">draw_arrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">depol_central</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">depol_contour</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">depol_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">subplots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">N_prob</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
                 <span class="n">contour_levels</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="p">),</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Draws polarization ellipse of Jones vector.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        E (Jones_vector or Stokes): Light object.</span>
<span class="sd">        N_angles (int): Number of angles to plot the ellipses. Default: 91.</span>
<span class="sd">        limit (float): limit for drawing. If empty, it is obtained from ampltiudes.</span>
<span class="sd">        filename (str): name of filename to save the figure.</span>
<span class="sd">        figsize (tuple): A tuple of length 2 containing the figure size. Default: (8,8).</span>
<span class="sd">        draw_arrow (bool): If True, draws an arrow containing the turning sense of the polarization. Does not work with linear polarization vectors. Default: True.</span>
<span class="sd">        depol_central (bool): If True, draws a central circle containing the unpolarized field amplitude. Default: False.</span>
<span class="sd">        depol_contour (bool): If True, draws a line enveloping the polarization ellipse in ordeer to plot the depolarization. Default: False.</span>
<span class="sd">        depol_dist (bool): If True, plots the probability distribution of the electric field. Default: False.</span>
<span class="sd">        subplots (string, tuple or None): If AS_SHAPE, divides the figure in several subplots as the shape of the py_pol object. If INDIVIDUAL, each vector is represented in its own subaxis, trying to use a square grid. If tuple, divides the figure in that same number of subplots. If None, all ellipses are plot in the same axes. Default: None.</span>
<span class="sd">        N_prob (int): Number of points in each dimension for probability distributions. Default: 256.</span>
<span class="sd">        prob (flota, np.ndarray, tuple or list): Contains the contour levels (normalized to 1). Default: 0.9.</span>
<span class="sd">        cmap (str or color object): Default colormap for probability distributions. Default: hot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig (handle): handle to figure.</span>
<span class="sd">        ax (list of handles): handles to axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate the electric field amplitudes and the delays</span>
    <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Jones_vector&#39;</span><span class="p">:</span>
        <span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">amplitudes</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">E0u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">E0x</span><span class="p">,</span> <span class="n">E0y</span><span class="p">,</span> <span class="n">E0u</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">amplitudes</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">give_unpol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">global_phase</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">E0x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">phase</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">phase</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Create the angle variables</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span> <span class="o">*</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">N_angles</span><span class="p">)</span>
    <span class="n">Angles</span><span class="p">,</span> <span class="n">E0X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">E0x</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">E0Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">E0y</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">Delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">Phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Jones_vector&#39;</span><span class="p">:</span>
        <span class="n">is_linear</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">is_linear</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_linear</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">is_linear</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">use_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Create the electric field distributions</span>
    <span class="n">Ex</span> <span class="o">=</span> <span class="n">E0X</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Angles</span> <span class="o">+</span> <span class="n">Phase</span><span class="p">)</span>
    <span class="n">Ey</span> <span class="o">=</span> <span class="n">E0Y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Angles</span> <span class="o">+</span> <span class="n">Phase</span> <span class="o">+</span> <span class="n">Delay</span><span class="p">)</span>
    <span class="c1"># Calculate the depolarization central distribution</span>
    <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span> <span class="ow">and</span> <span class="n">depol_central</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">E0U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">E0u</span><span class="p">)</span>
        <span class="n">Exu</span> <span class="o">=</span> <span class="n">E0U</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Angles</span><span class="p">)</span>
        <span class="n">Eyu</span> <span class="o">=</span> <span class="n">E0U</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Angles</span><span class="p">)</span>
    <span class="c1"># Safety arrays</span>
    <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span><span class="p">:</span>
        <span class="n">is_pol</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">is_polarized</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">is_depol</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">is_depolarized</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_number</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">is_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_pol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">E0x</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="c1"># Set automatic limits</span>
    <span class="k">if</span> <span class="n">limit</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">depol_contour</span> <span class="ow">or</span> <span class="n">depol_prob</span><span class="p">:</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E0x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">E0u</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                              <span class="n">E0y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">E0u</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E0x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">E0y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">E0u</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.2</span>

    <span class="c1"># Prepare the figure and the subplots</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">depol_prob</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">subplots</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subplots</span><span class="p">)):</span>
            <span class="k">pass</span>  <span class="c1"># Only case subplots is not overwritten</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subplots</span> <span class="o">=</span> <span class="s1">&#39;individual&#39;</span>
    <span class="k">if</span> <span class="n">subplots</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Just one subplot</span>
        <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nsubplots</span><span class="p">,</span> <span class="n">Ncurves</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">subplots</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="c1"># Set number of subplots</span>
        <span class="n">Nsubplots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subplots</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span> <span class="o">%</span> <span class="n">Nsubplots</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Shape </span><span class="si">{}</span><span class="s1"> is not valid for the object </span><span class="si">{}</span><span class="s1"> of </span><span class="si">{}</span><span class="s1"> elements&#39;</span><span class="o">.</span>
                <span class="nb">format</span><span class="p">(</span><span class="n">subplots</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">Ncurves</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">Nsubplots</span>
        <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">indS</span><span class="p">,</span> <span class="n">indE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">subplots</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;AS_SHAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;as_shape&#39;</span><span class="p">,</span> <span class="s1">&#39;As_shape&#39;</span><span class="p">):</span>
        <span class="c1"># Subplots given by phase</span>
        <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">Nsubplots</span><span class="p">,</span> <span class="n">Ncurves</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">Nsubplots</span><span class="p">,</span> <span class="n">Ncurves</span> <span class="o">=</span> <span class="p">(</span><span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">))</span>
        <span class="n">indS</span><span class="p">,</span> <span class="n">indE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">subplots</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="s1">&#39;Individual&#39;</span><span class="p">,</span> <span class="s1">&#39;INDIVIDUAL&#39;</span><span class="p">):</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">Ny</span><span class="p">))</span>
        <span class="n">Nsubplots</span><span class="p">,</span> <span class="n">Ncurves</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid subplots option.&#39;</span><span class="p">)</span>
    <span class="c1"># If contour lines or probability must be plotted, calculate the probability distributions and linestyles</span>
    <span class="k">if</span> <span class="n">depol_contour</span> <span class="ow">or</span> <span class="n">depol_prob</span><span class="p">:</span>
        <span class="c1"># Create the basic probability distribution</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">N_prob</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">E0U</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">E0u</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">E0U</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="c1"># Create the ellipse distribution</span>
        <span class="n">indX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Ex</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">indY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Ey</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">indE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">N_angles</span><span class="p">)</span>
        <span class="c1"># indE = np.flip(indE)</span>
        <span class="n">ellipse_3D</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">ellipse_3D</span><span class="p">[</span><span class="n">indE</span><span class="p">,</span> <span class="n">indY</span><span class="p">,</span> <span class="n">indX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Convolute them adn normalize to 1</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">fftconvolve</span><span class="p">(</span><span class="n">ellipse_3D</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">MAX</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prob</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">prob</span> <span class="o">/</span> <span class="n">MAX</span>
        <span class="c1"># Remove info for totally polarized vectors</span>
        <span class="n">prob</span><span class="p">[</span><span class="o">~</span><span class="n">is_depol</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Linestyles</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contour_levels</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linestyles</span><span class="p">):</span>
            <span class="n">line_styles</span> <span class="o">=</span> <span class="n">linestyles</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">contour_levels</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_styles</span> <span class="o">=</span> <span class="n">linestyles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Main loop</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>  <span class="c1"># Loop in curves</span>
        <span class="c1"># Initial considerations for the subplot</span>
        <span class="n">indS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ind</span> <span class="o">/</span> <span class="n">Ncurves</span><span class="p">))</span>
        <span class="n">indC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind</span> <span class="o">%</span> <span class="n">Ncurves</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">indS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Nsubplots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">subplots</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="s1">&#39;Individual&#39;</span><span class="p">,</span> <span class="s1">&#39;INDIVIDUAL&#39;</span><span class="p">):</span>
                    <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">indS</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">indS</span><span class="p">,</span> <span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">))))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
        <span class="c1"># Other considerations</span>
        <span class="k">if</span> <span class="n">depol_prob</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">name_colors</span><span class="p">[</span><span class="n">ind</span> <span class="o">%</span> <span class="mi">10</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">subplots</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;AS_SHAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;as_shape&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;As_shape&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">Ncurves</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Ncurves</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;Polarized&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="c1"># Plot the probability distribution</span>
        <span class="k">if</span> <span class="n">depol_prob</span> <span class="ow">and</span> <span class="n">is_depol</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
            <span class="n">IDimage</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                                  <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span>
                                  <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                  <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                                  <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">])</span>
            <span class="c1"># axis = axis[0]</span>
        <span class="c1"># Plot the curve</span>
        <span class="k">if</span> <span class="n">is_pol</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Ex</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Ey</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">draw_arrow</span> <span class="ow">and</span> <span class="o">~</span><span class="n">is_linear</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">Ex</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="n">Ey</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="n">Ex</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">Ex</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="n">Ey</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">Ey</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">head_width</span><span class="o">=</span><span class="mf">0.075</span> <span class="o">*</span> <span class="n">limit</span><span class="p">,</span>
                           <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                           <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">E</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span> <span class="ow">and</span> <span class="n">depol_central</span> <span class="ow">and</span> <span class="o">~</span><span class="n">is_depol</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                      <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="n">string</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">depol_central</span> <span class="ow">or</span> <span class="n">depol_prob</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Field </span><span class="si">{}</span><span class="s1"> is empty.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Field </span><span class="si">{}</span><span class="s1"> is empty or totally depolarized.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
        <span class="c1"># Add the depolarization for Stokes vectors</span>
        <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span> <span class="ow">and</span> <span class="n">depol_central</span> <span class="ow">and</span> <span class="n">is_depol</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Exu</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:],</span> <span class="n">Eyu</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s1">&#39;Stokes&#39;</span> <span class="ow">and</span> <span class="n">depol_contour</span> <span class="ow">and</span> <span class="n">is_pol</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="ow">and</span> <span class="n">is_depol</span><span class="p">[</span>
                <span class="n">ind</span><span class="p">]:</span>
            <span class="n">CS</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">prob</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                <span class="n">contour_levels</span><span class="p">,</span>
                <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="n">color</span><span class="p">),</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="c1"># linestyles=line_styles)</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;dashdot&#39;</span><span class="p">))</span>
        <span class="c1"># Additions to figure</span>
        <span class="k">if</span> <span class="n">indC</span> <span class="o">==</span> <span class="n">Ncurves</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$E_x (V/m)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$E_y (V/m)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Ncurves</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">depol_contour</span> <span class="ow">and</span> <span class="n">indC</span> <span class="o">==</span> <span class="n">Ncurves</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">contour_levels</span><span class="p">):</span>
                    <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;P = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">depol_prob</span> <span class="ow">and</span> <span class="n">is_depol</span><span class="p">[</span><span class="n">indS</span><span class="p">]:</span>
                <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">IDimage</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
                <span class="n">IDimage</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Nsubplots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
    <span class="c1"># Save the image if required</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[],</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image </span><span class="si">{}</span><span class="s1"> saved succesfully!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<span class="c1">#</span>
<span class="c1"># def draw_ellipse_stokes(stokes_0,</span>
<span class="c1">#                         kind=&#39;&#39;,</span>
<span class="c1">#                         limit=&#39;&#39;,</span>
<span class="c1">#                         has_line=True,</span>
<span class="c1">#                         filename=&#39;&#39;):</span>
<span class="c1">#     &quot;&quot;&quot; Draws polarization ellipse in stokes vector. If unpolarized light is present, a distribution of probability is given.</span>
<span class="c1">#</span>
<span class="c1">#     Parameters:</span>
<span class="c1">#         stokes_0 (Stokes): Stokes vector</span>
<span class="c1">#         kind (str): &#39;line&#39; &#39;probabilities&#39;. &#39;Line&#39;: polarized + unpolarized ellipses. &#39;probabilities&#39; is for unpolarized. Provides probabilities&#39;</span>
<span class="c1">#         limit (float): limit for drawing. If empty itis obtained from ampltiudes</span>
<span class="c1">#         has_line (bool or float): If True  draws polarized and 0.1 probability lines. If it is a number draws that probability.</span>
<span class="c1">#         filename (str): if filled, name for drawing</span>
<span class="c1">#</span>
<span class="c1">#     Returns:</span>
<span class="c1">#         ax (handle): handle to axis.</span>
<span class="c1">#         fig (handle): handle to figure.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#     parameters = stokes_0.parameters.get_all()</span>
<span class="c1">#</span>
<span class="c1">#     E0x, E0y, E0_unpol = parameters[&#39;amplitudes&#39;]</span>
<span class="c1">#     delay = parameters[&#39;delay&#39;]</span>
<span class="c1">#</span>
<span class="c1">#     angles = linspace(0, 360 * degrees, 256)</span>
<span class="c1">#     Ex = E0x * cos(angles)</span>
<span class="c1">#     Ey = E0y * cos(angles + delay)</span>
<span class="c1">#     E_unpolarized_x = E0_unpol * cos(angles)</span>
<span class="c1">#     E_unpolarized_y = E0_unpol * sin(angles)</span>
<span class="c1">#</span>
<span class="c1">#     if limit in [0, &#39;&#39;, [], None]:</span>
<span class="c1">#         radius_max = sqrt(</span>
<span class="c1">#             ((Ex + E_unpolarized_x)**2 + (Ey + E_unpolarized_y)**2).max())</span>
<span class="c1">#         limit = radius_max * 1.25</span>
<span class="c1">#</span>
<span class="c1">#     x = linspace(-limit, limit, 256)</span>
<span class="c1">#     y = linspace(-limit, limit, 256)</span>
<span class="c1">#     X, Y = meshgrid(x, y)</span>
<span class="c1">#</span>
<span class="c1">#     if abs(E0_unpol) &lt; eps or kind == &#39;line&#39;:</span>
<span class="c1">#         fig = plt.figure()</span>
<span class="c1">#         ax = fig.add_subplot(111)</span>
<span class="c1">#         ax.plot(Ex, Ey, &#39;k&#39;, lw=2, label=&#39;polarized&#39;)</span>
<span class="c1">#         ax.plot(E_unpolarized_x,</span>
<span class="c1">#                 E_unpolarized_y,</span>
<span class="c1">#                 &#39;r--&#39;,</span>
<span class="c1">#                 lw=2,</span>
<span class="c1">#                 label=&#39;unpolarized&#39;)</span>
<span class="c1">#         plt.grid(True)</span>
<span class="c1">#     else:</span>
<span class="c1">#         sigma = E0_unpol</span>
<span class="c1">#</span>
<span class="c1">#         u_random = exp(-(X**2 + Y**2) / (sigma**2))</span>
<span class="c1">#</span>
<span class="c1">#         ellipse_2D = zeros_like(X, dtype=float)</span>
<span class="c1">#         i_positions, _, _ = nearest2(x, Ex)</span>
<span class="c1">#         j_positions, _, _ = nearest2(y, Ey)</span>
<span class="c1">#         ellipse_2D[j_positions, i_positions] = 1</span>
<span class="c1">#</span>
<span class="c1">#         prob = fftconvolve(ellipse_2D, u_random, mode=&#39;same&#39;)</span>
<span class="c1">#         prob = prob / prob.max()</span>
<span class="c1">#</span>
<span class="c1">#         fig, ax, IDimage = draw2D(prob, x, y)</span>
<span class="c1">#         if isinstance(has_line, (int, float)):</span>
<span class="c1">#             plt.contour(x,</span>
<span class="c1">#                         y,</span>
<span class="c1">#                         prob, (has_line, ),</span>
<span class="c1">#                         colors=(&#39;w&#39;),</span>
<span class="c1">#                         linestyles=(&#39;dashed&#39;))</span>
<span class="c1">#         if has_line is True:</span>
<span class="c1">#             plt.contour(x,</span>
<span class="c1">#                         y,</span>
<span class="c1">#                         prob, (0.1, ),</span>
<span class="c1">#                         colors=(&#39;w&#39;),</span>
<span class="c1">#                         linestyles=(&#39;dashed&#39;))</span>
<span class="c1">#         if has_line is not False:</span>
<span class="c1">#             plt.plot(Ex, Ey, &#39;k&#39;, lw=1)</span>
<span class="c1">#</span>
<span class="c1">#         plt.grid(False)</span>
<span class="c1">#</span>
<span class="c1">#     plt.axis(&#39;equal&#39;)</span>
<span class="c1">#     plt.axis(&#39;square&#39;)</span>
<span class="c1">#     ax.set_xlabel(&#39;$E_x$&#39;, fontsize=22)</span>
<span class="c1">#     ax.set_ylabel(&#39;$E_y$&#39;, fontsize=22)</span>
<span class="c1">#     ax.set_xlim(-limit, limit)</span>
<span class="c1">#     ax.set_ylim(-limit, limit)</span>
<span class="c1">#     plt.legend()</span>
<span class="c1">#     plt.tight_layout()</span>
<span class="c1">#     if filename not in (None, [], &#39;&#39;):</span>
<span class="c1">#         plt.savefig(filename)</span>
<span class="c1">#     return ax, fig</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># def set_aspect_equal_3d(ax):</span>
<span class="c1">#     &quot;&quot;&quot;Fix equal aspect bug for 3D plots.&quot;&quot;&quot;</span>
<span class="c1">#     xlim = (-1, 1)</span>
<span class="c1">#     ylim = (-1, 1)</span>
<span class="c1">#     zlim = (-1, 1)</span>
<span class="c1">#</span>
<span class="c1">#     xmean = mean(xlim)</span>
<span class="c1">#     ymean = mean(ylim)</span>
<span class="c1">#     zmean = mean(zlim)</span>
<span class="c1">#</span>
<span class="c1">#     plot_radius = max([</span>
<span class="c1">#         abs(lim - mean_)</span>
<span class="c1">#         for lims, mean_ in ((xlim, xmean), (ylim, ymean), (zlim, zmean))</span>
<span class="c1">#         for lim in lims</span>
<span class="c1">#     ])</span>
<span class="c1">#</span>
<span class="c1">#     factor = 1</span>
<span class="c1">#     ax.set_xlim3d([xmean - factor * plot_radius, xmean + factor * plot_radius])</span>
<span class="c1">#     ax.set_ylim3d([ymean - factor * plot_radius, ymean + factor * plot_radius])</span>
<span class="c1">#     ax.set_zlim3d([zmean - 1 * plot_radius, zmean + 1 * plot_radius])</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Luis Miguel Sanchez Brea / Jesus del Hoyo

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>